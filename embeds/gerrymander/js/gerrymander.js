function checkZip(){if(1==callToAction.state&&""==callToAction.zip.value&&""!=callToAction.city.value&&""!=callToAction.stateInput.value&&(callToAction.lastCityCheck!=callToAction.city.value||callToAction.lastStateCheck!=callToAction.stateInput.value)){callToAction.lastCityCheck=callToAction.city.value,callToAction.lastStateCheck=callToAction.stateInput.value;var xhr=new XMLHttpRequest;xhr.open("GET","https://us-zipcode.api.smartystreets.com/lookup?auth-id=8660c680-a964-2e92-ebe7-9791d2e5a235&auth-token=tUlg9j7quI6rz3xIfC3e&city="+callToAction.city.value+"&state="+callToAction.stateInput.value,!0),xhr.setRequestHeader("Content-type","application/json"),xhr.onload=function(e){if(4===xhr.readyState)if(200===xhr.status){if(null!=xhr.responseText){var jsonZipList=JSON.parse(xhr.responseText);null!=jsonZipList&&null!=jsonZipList[0].zipcodes&&(callToAction.zip.setValue(jsonZipList[0].zipcodes[0].zipcode),callToAction.zip.value=jsonZipList[0].zipcodes[0].zipcode)}}else console.error(xhr.statusText)},xhr.onerror=function(e){console.error(xhr.statusText)},xhr.send()}}function onFontLoaded(){fontLoaded=!0}function setUpRemoveAnimations(){audio.playSound(SoundType.CLICK),animations=[];var animation=new Animation(splashTitle,AnimationType.MOVE,new Phaser.Point(splashTitle.x,splashTitle.y),new Phaser.Point(splashTitle.x,-splashTitle.height),0,0,null,null,ANIM_OUT_SPEED,0,0,0,!1,!1);animations.push(animation),animation=new Animation(splashPlayButton,AnimationType.MOVE,new Phaser.Point(splashPlayButton.x,splashPlayButton.y),new Phaser.Point(splashPlayButton.x,gameHeight+splashPlayButton.height),0,0,null,null,ANIM_OUT_SPEED,0,0,0,!1,!1),animations.push(animation),animations[0].setNextAnimation(animation),animation=new Animation(gtLinkButton,AnimationType.FADE_OUT,null,null,0,0,null,null,0,0,FADE_OUT_SPEED,0,!1,!1),animations.push(animation),animations[1].setNextAnimation(animation),animations[2].setCallback(loadMainState),animations[0].state=AnimationState.ON}function loadMainState(){game.state.start("main")}function tiltTitle(){var animation=new Animation(splashTitle,AnimationType.ROTATE,null,null,-10,10,null,null,0,.5,0,0,!1,!0);animation.ease=!0,animations.push(animation),animation.state=AnimationState.ON}function declareGame(){(game=new Phaser.Game(gameWidth,gameHeight,Phaser.AUTO,"")).state.add("boot",bootState),game.state.add("preload",preloadState),game.state.add("start",startState),game.state.add("main",mainState),game.state.start("boot"),Phaser.Device.whenReady(function(){game.stage.backgroundColor="#ffffff",game.scale.scaleMode=Phaser.ScaleManager.SHOW_ALL,game.scale.setMinMax(600,400,800,534),game.add.plugin(PhaserInput.Plugin),game.plugins.add(PhaserNineSlice.Plugin)})}function generateLevel(){null!=walkthrough&&walkthrough.finish&&(walkthrough.finish=!1,boardBG.x=.43*gameWidth,levelText.y=.02*gameHeight,teamText.x=.115*gameWidth,voteStatus.bar.playerBar.x=0,populationStatus.bar.playerBar.x=STATUS_BAR_X,populationStatus.bar.opponentBar.x=STATUS_BAR_X+populationStatus.bar.playerBar.width,populationStatus.bar.noneBar.x=STATUS_BAR_X+populationStatus.bar.playerBar.width+populationStatus.bar.opponentBar.width,populationStatus.text.x=populationStatus.text.width/2+STATUS_BAR_X,populationStatus.setWidths(),voteStatus.bar.playerBar.x=STATUS_BAR_X,voteStatus.bar.opponentBar.x=STATUS_BAR_X+voteStatus.bar.playerBar.width,voteStatus.bar.noneBar.x=STATUS_BAR_X+voteStatus.bar.playerBar.width+voteStatus.bar.opponentBar.width,voteStatus.text.x=voteStatus.text.width/2+STATUS_BAR_X,voteStatus.setWidths(),doneButton.y=.93*gameHeight,settings.show(),roundScoreText.alpha=1,totalScoreText.alpha=1,dialog.setGameLocation(),walkthrough.removeForGame()),0==getRandomInt(0,1)||gameMode==GameMode.WALKTHROUGH?(playerColor=TileColor.BLUE,teamText.text="HELP BLUE WIN",teamText.fill=BLUE_HEX_STRING,opponentColor=TileColor.RED):(playerColor=TileColor.RED,teamText.text="HELP RED WIN",teamText.fill=RED_HEX_STRING,opponentColor=TileColor.BLUE);new Phaser.Point(teamText.scale.x,teamText.scale.y);teamText.scale.setTo(0,0),animations=[];var animation=new Animation(teamText,AnimationType.SCALE_IN,null,null,0,0,new Phaser.Point(0,0),new Phaser.Point(1,1),0,0,0,SCALE_IN_SPEED,!1,!1);animation.setCallback(pulseTeamText),animations.push(animation),animation.state=AnimationState.ON,populationStatus.setBarTint(),voteStatus.setBarTint(),deactivateDoneButton(),noMoveTime=0,noMove=!1,corners=[],selecting=!1,startTile=null,currentTile=null,levelGroup=game.add.group(),levelData=[];var pattern;currentLevelIndex==patterns.length?(pattern=gameMode==GameMode.WALKTHROUGH?patternTypes[0].getFirstPattern():patternTypes[patternTypeIndex].getPattern(),patterns.push(pattern)):pattern=gameMode==GameMode.WALKTHROUGH?patterns[0]:patterns[currentLevelIndex];for(i=0;i<pattern[0].length;i++){levelData[i]=[];for(j=0;j<pattern.length;j++)levelData[i].push(pattern[j][i])}districtSize=patternTypes[patternTypeIndex].height,usableWidth=patternTypes[patternTypeIndex].width,usableHeight=patternTypes[patternTypeIndex].height,gridWidth=pattern[0].length,gridHeight=pattern.length,gameMode==GameMode.WALKTHROUGH?levelText.text="Tutorial":levelText.text="LEVEL "+currentLevelIndex,tileScaleMod=1,5==gridWidth&&gridHeight<=5||gridWidth<=5&&6==gridHeight?tileScaleMod=.75:6==gridWidth||6==gridHeight?tileScaleMod=.65:7==gridWidth&&7==gridHeight&&(tileScaleMod=.55),tileGap=TILE_GAP*SCALE*tileScaleMod,offset=new Phaser.Point(0,0),tiles=[],tileIndexes=0,playerCountyCount=0,opponentCountyCount=0;for(i=0;i<gridWidth;i++)tiles[i]=[];for(var tilesUsed=[],i=0;i<gridWidth*gridHeight;i++)tilesUsed.push(i);for(var largestIndex=-1,i=0;i<gridWidth;i++)for(j=0;j<gridHeight;j++)levelData[i][j]>largestIndex&&(largestIndex=parseInt(levelData[i][j]));for(var maxCount=Math.floor(usableHeight/2)+1,winnableGroups=[],i=0;i<=largestIndex;i++)winnableGroups.push(0);var lowestPossibleCount=Math.ceil((largestIndex+1)/2),winnableCount=0;1==currentPatternIndex?winnableCount=lowestPossibleCount:(winnableCount=lowestPossibleCount+currentPatternIndex-1)>usableWidth-1&&(winnableCount=usableWidth-1);for(i=0;i<winnableCount;i++)for(var gotGroup=!1;!gotGroup;){var winnableIndex=getRandomInt(0,gridWidth-1);0==winnableGroups[winnableIndex]&&(gotGroup=!0,winnableGroups[winnableIndex]=1,0)}for(var groupCounts=[],i=0;i<=largestIndex;i++)groupCounts.push(0);groupIndexes=[];for(i=0;i<usableWidth;i++)groupIndexes.push([]);for(tileGroup=game.add.group();tilesUsed.length>0;){var nextIndex=getRandomInt(0,tilesUsed.length-1),i=(index=tilesUsed[nextIndex])%gridWidth,j=Math.floor(index/gridWidth),tileType=parseInt(levelData[i][j]);tileType>6&&console.log("HERE - "+i+", "+j),-1==tileType?tiles[i][j]=new Tile(TileColor.NONE,i,j):(null==groupIndexes[tileType]&&console.log("this is the breaking point "+groupIndexes.length+", "+tileType+" --- "+patternTypes[patternTypeIndex].id+" --- "+patternTypeIndex+" --- "+patternTypes[patternTypeIndex].type),groupIndexes[tileType].push(new Phaser.Point(i,j)),1==winnableGroups[tileType]&&groupCounts[tileType]<maxCount?(tiles[i][j]=new Tile(playerColor,i,j),groupCounts[tileType]++):tiles[i][j]=new Tile(opponentColor,i,j)),tilesUsed.splice(nextIndex,1)}tileWidth=tiles[0][0].sprite.width/2,offset.x=(GAMEPLAY_WIDTH-gridWidth*tileWidth)/2,offset.y=(GAMEPLAY_HEIGHT-gridHeight*tileWidth)/2;for(i=0;i<gridWidth;i++)for(j=0;j<gridHeight;j++)tiles[i][j].sprite.x+=offset.x,tiles[i][j].bg.x+=offset.x,tiles[i][j].sprite.y+=offset.y,tiles[i][j].bg.y+=offset.y,tiles[i][j].color!=TileColor.NONE&&(tiles[i][j].previewBG.x+=offset.x,tiles[i][j].previewBG.y+=offset.y);hConnectors=[];for(i=0;i<gridWidth-1;i++)for(j=0;j<gridHeight;j++){(connector=connectorGroup.create(0,0,"spritesheet1","county_connector")).scale.setTo(SCALE*tileScaleMod,SCALE*tileScaleMod),connector.x=tiles[i][j].bg.x+tiles[i][j].bg.width/2,connector.y=tiles[i][j].bg.y+tiles[i][j].bg.height/2-connector.height/2,connector.active=!0,hConnectors.push(connector),(tiles[i][j].color==TileColor.NONE||i==gridWidth-2&&tiles[i+1][j].color==TileColor.NONE)&&(connector.active=!1,connector.alpha=0)}vConnectors=[];for(i=0;i<gridWidth;i++)for(j=0;j<gridHeight-1;j++){var connector=connectorGroup.create(0,0,"spritesheet1","county_connector_v");connector.scale.setTo(SCALE*tileScaleMod,SCALE*tileScaleMod),connector.x=tiles[i][j].sprite.x+tiles[i][j].sprite.width/2-connector.width/2-tiles[i][j].bg.width/2,connector.y=tiles[i][j].sprite.y+tiles[i][j].sprite.height/2-tiles[i][j].bg.width/2,connector.active=!0,vConnectors.push(connector),(tiles[i][j].color==TileColor.NONE||j==gridHeight-2&&tiles[i][j+1].color==TileColor.NONE)&&(connector.active=!1,connector.alpha=0)}for(var index=-1,i=0;i<gridWidth;i++)for(j=0;j<gridHeight;j++)i>0&&(index=gridWidth<=2?j:(i-1)*gridHeight+j%gridWidth,tiles[i][j].lConnect=hConnectors[index]),i<gridWidth-1&&(index=i*gridHeight+j%gridWidth,tiles[i][j].rConnect=hConnectors[index]),j>0&&(index=i*(gridHeight-1)+j-1,tiles[i][j].tConnect=vConnectors[index]),j<gridHeight-1&&(index=i*(gridHeight-1)+j,tiles[i][j].bConnect=vConnectors[index]);hLines=[];for(i=0;i<gridWidth+1;i++)hLines[i]=[];vLines=[];for(i=0;i<gridHeight+1;i++)vLines[i]=[];for(i=0;i<gridWidth;i++)for(j=0;j<gridHeight+1;j++)hLines[i][j]=new Line(0,i,j);for(i=0;i<gridHeight;i++)for(j=0;j<gridWidth+1;j++)vLines[i][j]=new Line(1,i,j);for(i=0;i<gridWidth;i++)for(j=0;j<gridHeight;j++){var topLine=hLines[i][j],bottomLine=hLines[i][j+1],leftLine=vLines[j][i],rightLine=vLines[j][i+1];tiles[i][j].assignLines(topLine,bottomLine,leftLine,rightLine)}var totalCounties=usableWidth*usableHeight,minimumVoteNeeded=playerCountyCount/totalCounties;populationStatus.setWidths(minimumVoteNeeded,opponentCountyCount/totalCounties);var baseCounties=Math.floor(gridHeight/2)+1;numberOfWinnableDistricts=playerCountyCount/baseCounties,calculateDistricts()}function pulseTeamText(){animations=[];var animation=new Animation(teamText,AnimationType.PULSE,null,null,null,null,new Phaser.Point(.8,.8),new Phaser.Point(1,1),0,0,0,.01,!1,!1);animations.push(animation),animation.state=AnimationState.ON}function resetForWalkthrough(){boardBG.x=.43*gameWidth-WALKTHROUGH_X_ADJ+8,roundScoreText.alpha=0,totalScoreText.alpha=0,dialog.setWalkthroughLocation(),settings.hide(),hideDoneButton(),levelText.y=-levelText.height,teamText.x=1.5*-teamText.width}function startWalkthrough(){null==walkthrough?walkthrough=new Walkthrough:walkthrough.reset(),walkthrough.activate()}function calculateDistricts(){groups=[];for(i=0;i<gridWidth;i++)for(j=0;j<gridHeight;j++)tiles[i][j].checked=!1,tiles[i][j].bg.alpha=0;for(i=0;i<gridWidth;i++)for(j=0;j<gridHeight;j++)if(currentGroup=new TileGroup,!tiles[i][j].checked&&tiles[i][j].selected&&checkTile(i,j,currentGroup),currentGroup.tiles.length>0){for(var k=0;k<currentGroup.tiles.length;k++){tile=currentGroup.tiles[k];currentGroup.addLine(tile.top),currentGroup.addLine(tile.bottom),currentGroup.addLine(tile.left),currentGroup.addLine(tile.right)}groups.push(currentGroup)}calculateDistrictCounts();for(var i=0;i<groups.length;i++)for(var j=0;j<groups[i].tiles.length;j++){var tile=groups[i].tiles[j],faded=!1;groups[i].tiles.length!=districtSize&&(faded=!0),tile.setColor(groups[i].color,faded)}setBars(),calculateStars(),calculateScore(),playerDistrictCount+opponentDistrictCount+tieDistrictCount==usableWidth&&0==starCount&&dialog.setNudge(2,"")}function calculateDistrictCounts(){playerDistrictCount=0,opponentDistrictCount=0,tieDistrictCount=0;for(var i=0;i<groups.length;i++)groups[i].calculateColor(),groups[i].color==playerColor&&groups[i].tiles.length==districtSize?playerDistrictCount++:groups[i].color==opponentColor&&groups[i].tiles.length==districtSize?opponentDistrictCount++:groups[i].tiles.length==districtSize&&tieDistrictCount++}function calculateStars(){if(starCount=0,groups.length==usableWidth){var populationPercent=100*(playerCountyCount/(playerCountyCount+opponentCountyCount)).toFixed(2),totalDistricts=usableWidth,districtPercent=100*(playerDistrictCount/totalDistricts).toFixed(2),districtOriginal=100*(tieDistrictCount/totalDistricts).toFixed(2);if((districtPercent+=Math.round(districtOriginal/2))-populationPercent>0)if(playerDistrictCount>=numberOfWinnableDistricts)starCount=3;else{(playerDistrictCount+tieDistrictCount/2)/totalDistricts>playerCountyCount/(usableWidth*usableHeight)&&(starCount=1)}}gameMode!=GameMode.WALKTHROUGH&&checkDoneButton()}function calculateScore(){Math.round(playerCountyCount/(playerCountyCount+opponentCountyCount)*100);var totalDistricts=usableWidth,districtPercent=Math.round(playerDistrictCount/totalDistricts*100),districtOriginal=Math.round(tieDistrictCount/totalDistricts*100);districtPercent+=Math.round(districtOriginal/2);(roundScore=25*playerDistrictCount+10*opponentDistrictCount)<0&&(roundScore=0),roundScoreText.text="ROUND SCORE: "+roundScore,totalScoreText.text="TOTAL SCORE: "+(totalScore+roundScore)}function setBars(){var totalDistricts=usableWidth;playerDistrictPercent=playerDistrictCount/totalDistricts;var opponentDistrictPercent=opponentDistrictCount/totalDistricts,tieDistrictPercent=tieDistrictCount/totalDistricts;voteStatus.setWidths(playerDistrictPercent,opponentDistrictPercent,tieDistrictPercent)}function setCorners(){for(i=0;i<corners.length;i++)corners[i].deselectCorner();for(var i=0;i<gridWidth;i++)for(var j=0;j<gridHeight;j++){var tile=tiles[i][j],color=findGroupColorForTile(tile);tile.selected&&(tile.i<gridWidth-1&&tile.top.on&&!tile.right.on&&!tiles[tile.i+1][tile.j].top.on&&null!=tile.ur&&tile.ur.selectCorner(TileCorner.BR,TileColor.TIE,color),tile.i>0&&tile.top.on&&!tile.left.on&&!tiles[tile.i-1][tile.j].top.on&&null!=tile.ul&&tile.ul.selectCorner(TileCorner.BL,TileColor.TIE,color),tile.j<gridHeight-1&&!tile.left.on&&!tile.bottom.on&&tiles[tile.i][tile.j+1].left.on&&null!=tiles[tile.i][tile.j+1].ul&&tiles[tile.i][tile.j+1].ul.selectCorner(TileCorner.UR,TileColor.TIE,color),tile.j<gridHeight-1&&!tile.right.on&&!tile.bottom.on&&tiles[tile.i][tile.j+1].right.on&&null!=tiles[tile.i][tile.j+1].ur&&tiles[tile.i][tile.j+1].ur.selectCorner(TileCorner.UL,TileColor.TIE,color))}}function setConnectors(){for(var i=0;i<gridWidth;i++)for(var j=0;j<gridHeight;j++)tiles[i][j].setConnectors()}function checkTile(i,j){if(tiles[i][j].checked)return!1;tiles[i][j].checked=!0,currentGroup.addTile(tiles[i][j]),!tiles[i][j].top.on&&j>0&&checkTile(i,j-1),!tiles[i][j].bottom.on&&j<gridHeight-1&&checkTile(i,j+1),!tiles[i][j].left.on&&i>0&&checkTile(i-1,j),!tiles[i][j].right.on&&i<gridWidth-1&&checkTile(i+1,j)}function getTileByIndex(index){for(var i=0;i<gridWidth;i++)for(var j=0;j<gridHeight;j++)if(tiles[i][j].index==index)return tiles[i][j];return null}function reset(){for(i=0;i<gridWidth;i++)for(j=0;j<gridHeight;j++)tiles[i][j].checked=!1,tiles[i][j].selected=!1;for(i=0;i<hLines.length;i++)for(j=0;j<hLines[i].length;j++)hLines[i][j].deselectLine(LineSide.ALL);for(var i=0;i<vLines.length;i++)for(var j=0;j<vLines[i].length;j++)vLines[i][j].deselectLine(LineSide.ALL);selecting=!1,calculateDistricts()}function submit(){dialog.remove(),audio.playSound(SoundType.CLICK),audio.playSound(SoundType.WIN),deactivateDoneButton(),gameMode=GameMode.WIN,calculateScore(),oldTotalScore=totalScore,(totalScore+=roundScore)>highScore&&(highScore=totalScore),null==results?results=new Results:results.reactivate(),gtag("event","finished-level",{level:currentLevelIndex})}function removeLevelElements(){levelGroup.removeAll(!0),connectorGroup.removeAll(!0)}function clickNextLevel(){audio.playSound(SoundType.CLICK),goToCTA=!1,goToNextLevel()}function goToNextLevel(){null!=results&&results.clearEmitters(),gameMode=GameMode.PLAY,next()}function next(){removeLevelElements(),currentLevelIndex<maxLevels-1?(currentLevelIndex==patterns.length-1?patternTypes[patternTypeIndex].patterns.length<=0?(patternTypeIndex++,currentPatternIndex=1):currentPatternIndex++:++currentPatternIndex>patternTypes[patternTypeIndex].count&&(currentPatternIndex=1,patternTypeIndex++),7==++currentLevelIndex||goToCTA?activateCallToAction():3==currentLevelIndex||5==currentLevelIndex?activateExample():generateLevel()):generateLevel()}function debugPrev(){currentLevelIndex>1&&(levelGroup.removeAll(!0),connectorGroup.removeAll(!0),currentLevelIndex--,--currentPatternIndex<=0&&(currentPatternIndex=patternTypes[--patternTypeIndex].count),generateLevel(),deactivateDoneButton())}function setInputPosition(){startInputPosition=new Phaser.Point(game.input.position.x,game.input.position.y)}function onInputDownTile(sprite){gameMode!=GameMode.PLAY&&gameMode!=GameMode.MOVE||sprite.tile.color==TileColor.NONE||(noMoveTime=0,noMove&&(0==dialog.nudgeIndex&&dialog.setNudgeResponse(!1),noMove=!1,removePreview()),gameMode=GameMode.MOVE,startMoveDate=new Date,currentTile=sprite.tile,sprite.tile.shrink())}function startCreateDistrict(){currentLines=[],currentSelectGroup=[],currentTile.top.selectLine(LineSide.TOP,TileColor.NONE),currentLines.push(currentTile.top),currentTile.bottom.selectLine(LineSide.BOTTOM,TileColor.NONE),currentLines.push(currentTile.bottom),currentTile.left.selectLine(LineSide.LEFT,TileColor.NONE),currentLines.push(currentTile.left),currentTile.right.selectLine(LineSide.RIGHT,TileColor.NONE),currentLines.push(currentTile.right),startTile=currentTile,currentTile.selected=!0,selecting=!0,currentSelectGroup.push(currentTile.index)}function onInputOverTile(sprite){if(gameMode==GameMode.PLAY||gameMode==GameMode.MOVE)if(selecting||sprite.tile.color==TileColor.NONE||sprite.tile.selected){if(selecting&&sprite.tile.color!=TileColor.NONE){noMoveTime=0;selectTile(sprite.tile)}}else sprite.tile.grow()}function selectTile(tile){tile!=startTile&&-1==currentSelectGroup.indexOf(tile.index)&&currentSelectGroup.length<districtSize&&(tile.selected=!0,-1!=currentLines.indexOf(tile.top)?tile.top.deselectLine(LineSide.ALL):(tile.top.selectLine(LineSide.TOP,TileColor.NONE),currentLines.push(tile.top),tile.j>0&&tiles[tile.i][tile.j-1].selected&&tile.top.selectLine(LineSide.BOTTOM,tile.top.color)),-1!=currentLines.indexOf(tile.bottom)?tile.bottom.deselectLine(LineSide.ALL):(tile.bottom.selectLine(LineSide.BOTTOM,TileColor.NONE),currentLines.push(tile.bottom),tile.j<gridHeight-1&&tiles[tile.i][tile.j+1].selected&&tile.bottom.selectLine(LineSide.TOP,tile.bottom.color)),-1!=currentLines.indexOf(tile.left)?tile.left.deselectLine(LineSide.ALL):(tile.left.selectLine(LineSide.LEFT,TileColor.NONE),currentLines.push(tile.left),tile.i>0&&tiles[tile.i-1][tile.j].selected&&tile.left.selectLine(LineSide.RIGHT,tile.left.color)),-1!=currentLines.indexOf(tile.right)?tile.right.deselectLine(LineSide.ALL):(tile.right.selectLine(LineSide.RIGHT,TileColor.NONE),currentLines.push(tile.right),tile.i<gridWidth-1&&tiles[tile.i+1][tile.j].selected&&tile.right.selectLine(LineSide.LEFT,tile.right.color)),currentSelectGroup.push(tile.index)),setCorners(),setConnectors()}function onInputOutTile(sprite){selecting||gameMode!=GameMode.PLAY&&gameMode!=GameMode.MOVE||sprite.tile.shrink()}function onInputUp(){if(selecting){calculateDistricts(),selecting=!1,gameMode=GameMode.PLAY;for(var deletedDistricts=!1,i=0;i<groups.length;i++)groups[i].tiles.length<districtSize&&(dialog.setNudge(0,districtSize),currentTile=groups[i].tiles[0],deleteDistrict(),deletedDistricts=!0);if(deletedDistricts)calculateDistricts();else{var xDiff=game.input.position.x-startInputPosition.x,yDiff=game.input.position.y-startInputPosition.y;if(xDiff<=DELETE_DIFF&&yDiff<=DELETE_DIFF&&moveTime<CLICK_TIME)deleteDistrict(),selecting=!1,gameMode=GameMode.PLAY,calculateDistricts(),setCorners(),setConnectors();else if(0==dialog.nudgeIndex)currentSelectGroup.length==usableHeight&&dialog.setNudgeResponse(!1);else if(1==dialog.nudgeIndex&&null!=emptyTiles&&emptyTiles.length>0){for(var tileOutsidePreview=!1,i=0;i<emptyTiles.length;i++){for(var foundTile=!1,j=0;j<currentSelectGroup.length;j++)emptyTiles[i].index==currentSelectGroup[j]&&(foundTile=!0);if(!foundTile){tileOutsidePreview=!0;break}}tileOutsidePreview?dialog.setNudgeResponse(!0):dialog.setNudgeResponse(!1)}}setCorners(),setConnectors()}}function deleteDistrict(){if(null!=currentTile){currentSelectGroup.length==usableHeight&&audio.playSound(SoundType.DELETE_DISTRICT);var groupIndex=findInGroup(currentTile);if(-1!=groupIndex){for(var group=groups[groupIndex],i=0;i<group.tiles.length;i++)group.tiles[i].selected=!1,group.tiles[i].top.turnOffLineGraphics(LineSide.TOP),group.tiles[i].bottom.turnOffLineGraphics(LineSide.BOTTOM),group.tiles[i].left.turnOffLineGraphics(LineSide.LEFT),group.tiles[i].right.turnOffLineGraphics(LineSide.RIGHT);for(i=0;i<group.lines.length;i++){for(var line=group.lines[i],found=!1,j=0;j<groups.length;j++){var otherGroup=groups[j];if(otherGroup!=group)for(var k=0;k<otherGroup.lines.length;k++)if(otherGroup.lines[k]==line){found=!0;break}}found||line.deselectLine(LineSide.ALL)}}}}function findInGroup(tile){for(var i=0;i<groups.length;i++)if(-1!=groups[i].tiles.indexOf(tile))return i;return-1}function findGroupColorForTile(tile){for(var color=TileColor.NONE,i=0;i<groups.length;i++)if(-1!=groups[i].tiles.indexOf(tile)){color=groups[i].color;break}return color}function clearStars(){for(var i=0;i<stars.length;i++)stars[i].tint=13421772}function checkDoneButton(){doneButton.alpha=1,starCount>0?(doneButton.inputEnabled=!0,doneButton.frame=2):deactivateDoneButton()}function deactivateDoneButton(){doneButton.inputEnabled=!1,doneButton.frame=0}function hideDoneButton(){doneButton.inputEnabled=!1,doneButton.alpha=0}function activateCallToAction(){null==callToAction?callToAction=new CallToAction:callToAction.reset()}function activateExample(){null==example?example=new Example:example.reset()}function activateShare(shareStr,fromResults){null==share&&(share=new Share),share.activate(shareStr,fromResults)}function findEmptyDistrict(){for(var emptyGroupIndex=-1,attemptCount=0;-1==emptyGroupIndex&&attemptCount<=usableHeight;){attemptCount++;for(var randomGroupIndex=getRandomInt(0,groupIndexes.length-1),anySelected=!1,i=0;i<groupIndexes[randomGroupIndex].length;i++)tiles[groupIndexes[randomGroupIndex][i].x][groupIndexes[randomGroupIndex][i].y].bg.selected&&(anySelected=!0);anySelected||(emptyGroupIndex=randomGroupIndex)}var redCount=0,blueCount=0;emptyTiles=[];if(-1!=emptyGroupIndex){for(i=0;i<groupIndexes[emptyGroupIndex].length;i++){var tile=tiles[groupIndexes[randomGroupIndex][i].x][groupIndexes[randomGroupIndex][i].y];tile.color==TileColor.RED?redCount++:blueCount++,emptyTiles.push(tile)}for(i=0;i<emptyTiles.length;i++)emptyTiles[i].previewBG.tint=redCount>blueCount?16766171:blueCount>redCount?13952511:13421772}}function pulsePreview(deltaTime){for(var i=0;i<emptyTiles.length;i++)emptyTiles[i].pulsePreview(deltaTime);1==previewAlphaDir&&emptyTiles[0].previewBG.alpha>=1?previewAlphaDir=-1:-1==previewAlphaDir&&emptyTiles[0].previewBG.alpha<=0&&(previewAlphaDir=1)}function removePreview(){for(var i=0;i<emptyTiles.length;i++)emptyTiles[i].removePreview()}function reactivateButtons(){settings.enableButtons()}function reps(){share.deactivate(),activateCallToAction()}function help(){audio.playSound(SoundType.CLICK),settings.disableButtons(),doneButton.inputEnabled=!1,removeLevelElements(),gameMode=GameMode.WALKTHROUGH,generateLevel(),resetForWalkthrough(),populationStatus.text.x=STATUS_BAR_START_X,populationStatus.bar.playerBar.x=STATUS_BAR_START_X,voteStatus.text.x=STATUS_BAR_START_X,voteStatus.bar.playerBar.x=STATUS_BAR_START_X,gerry.y=gameHeight+gerry.height/2,startWalkthrough()}function openGTLink(){window.open("http://www.gametheoryco.com")}function getRandomInt(min,max){return Math.floor(Math.random()*(max-min+1))+min}function getRandomDouble(min,max){return Math.random()*(max-min)+min}var BOUNCE_TOTAL=5,SCALE_BOUNCE_TOTAL=3;AnimationType={MOVE:0,FADE_IN:1,FADE_OUT:2,ROTATE:3,SCALE_IN:4,SCALE_OUT:5,DELAY:6,PULSE:7},AnimationState={OFF:0,ON:1,DONE:2,BOUNCE:3,OVER:4};class Animation{constructor(object,type,startPos,endPos,startAngle,endAngle,startScale,endScale,moveSpeed,rotateSpeed,fadeSpeed,scaleSpeed,bounce,loop){this.object=object,this.type=type,this.startPos=startPos,this.endPos=endPos,null!=this.startPos&&null!=this.endPos&&(this.direction=new Phaser.Point(this.endPos.x-this.startPos.x,this.endPos.y-this.startPos.y).normalize(),this.startDir=this.direction),this.startAngle=startAngle,this.endAngle=endAngle,this.startScale=startScale,this.endScale=endScale,this.moveSpeed=moveSpeed,this.fadeSpeed=fadeSpeed,this.rotateSpeed=rotateSpeed,this.scaleSpeed=scaleSpeed,this.bounce=bounce,this.loop=loop,this.rotateDir=1,this.bounceDir=0,this.bounces=0,this.delayTimer=0,this.ease=!1,this.type==AnimationType.ROTATE&&(this.originAngle=this.object.angle,this.animationTime=game.time.create(!1),this.startDate=new Date,this.frames=0,this.totalFrames=(this.endAngle-this.originAngle)/this.rotateSpeed),this.type==AnimationType.PULSE&&(this.pulseDir=-1),this.state=AnimationState.OFF}setDelayParams(delayTime,delaySpeed){this.delayTime=delayTime,this.delaySpeed=delaySpeed}setName(name){this.name=name}setNextAnimation(nextAnimation){this.nextAnimation=nextAnimation}setCallback(callback){this.callback=callback}setSound(soundType){this.soundType=soundType}update(){if(this.state==AnimationState.ON)switch(this.type){case AnimationType.MOVE:this.direction.x>0?(this.object.x<this.endPos.x&&(this.object.x+=this.direction.x*this.moveSpeed),this.object.x>=this.endPos.x&&(this.object.x=this.endPos.x)):this.direction.x<0&&(this.object.x>this.endPos.x&&(this.object.x+=this.direction.x*this.moveSpeed),this.object.x<=this.endPos.x&&(this.object.x=this.endPos.x)),this.direction.y>0?(this.object.y<this.endPos.y&&(this.object.y+=this.direction.y*this.moveSpeed),this.object.y>=this.endPos.y&&(this.object.y=this.endPos.y)):this.direction.y<0&&(this.object.y>this.endPos.y&&(this.object.y+=this.direction.y*this.moveSpeed),this.object.y<=this.endPos.y&&(this.object.y=this.endPos.y)),this.object.x==this.endPos.x&&this.object.y==this.endPos.y&&(this.bounce?(this.state=AnimationState.BOUNCE,this.startDir.x<0?this.bounceDir=new Phaser.Point(-1,0):this.startDir.x>0?this.bounceDir=new Phaser.Point(1,0):this.startDir.y<0?this.bounceDir=new Phaser.Point(0,-1):this.startDir.y>0&&(this.bounceDir=new Phaser.Point(0,1)),this.bounceDist=10):this.state=AnimationState.DONE);break;case AnimationType.FADE_IN:this.object.alpha+=this.fadeSpeed,this.object.alpha>=1&&(this.object.alpha=1,this.state=AnimationState.DONE);break;case AnimationType.FADE_OUT:this.object.alpha-=this.fadeSpeed,this.object.alpha<=0&&(this.object.alpha=0,this.state=AnimationState.DONE);break;case AnimationType.SCALE_IN:this.object.scale.setTo(this.object.scale.x+this.scaleSpeed,this.object.scale.y+this.scaleSpeed),this.object.scale.x>=this.endScale.x&&this.object.scale.y>=this.endScale.y&&(this.object.scale.setTo(this.endScale.x,this.endScale.y),this.bounce?(this.state=AnimationState.BOUNCE,this.bounceDir=1,this.bounceDist=.1*(this.endScale.x-this.startScale.x)):this.state=AnimationState.DONE);break;case AnimationType.SCALE_OUT:this.object.scale.setTo(this.object.scale.x-this.scaleSpeed,this.object.scale.y-this.scaleSpeed),this.object.scale.x<=this.endScale.x&&this.object.scale.y<=this.endScale.y&&(this.object.scale.setTo(this.endScale.x,this.endScale.y),this.bounce?(this.state=AnimationState.BOUNCE,this.bounceDir=-1,this.bounceDist=.1*(this.endScale.x-this.startScale.x)):this.state=AnimationState.DONE);break;case AnimationType.ROTATE:var angleDiff=0;if(this.frames++,this.ease){var percent=this.frames/this.totalFrames,v=Phaser.Easing.Sinusoidal.InOut(percent);1==this.rotateDir?this.object.angle=this.originAngle+(this.endAngle-this.originAngle)*v:this.object.angle=this.originAngle+(this.startAngle-this.originAngle)*v}else angleDiff=this.rotateSpeed*this.rotateDir*this.animationTime.elapsed,this.object.angle+=angleDiff;1==this.rotateDir&&this.object.angle>=this.endAngle?(this.animationTime=game.time.create(!1),this.object.angle=this.endAngle,this.loop?(this.frames=0,this.totalFrames=Math.abs(this.object.angle-this.startAngle)/this.rotateSpeed,this.originAngle=this.object.angle,this.rotateDir*=-1):this.state=AnimationState.DONE):-1==this.rotateDir&&this.object.angle<=this.startAngle&&(this.object.angle=this.startAngle,this.loop?(this.frames=0,this.totalFrames=Math.abs(this.object.angle-this.endAngle)/this.rotateSpeed,this.originAngle=this.object.angle,this.rotateDir*=-1):this.state=AnimationState.DONE);break;case AnimationType.DELAY:this.delayTimer+=this.delaySpeed,this.delayTimer>=this.delayTime&&(this.state=AnimationState.DONE);break;case AnimationType.PULSE:this.object.scale.setTo(this.object.scale.x+this.scaleSpeed*this.pulseDir,this.object.scale.y+this.scaleSpeed*this.pulseDir),-1==this.pulseDir?this.object.scale.x<=this.startScale.x&&this.object.scale.y<=this.startScale.y&&(this.object.scale.setTo(this.startScale.x,this.startScale.y),this.pulseDir=1):this.object.scale.x>=this.endScale.x&&this.object.scale.y>=this.endScale.y&&(this.object.scale.setTo(this.endScale.x,this.endScale.y),this.pulseDir=-1)}else if(this.state==AnimationState.BOUNCE)switch(this.type){case AnimationType.MOVE:0!=this.bounceDir.x?(this.object.x+=this.bounceDir.x*this.moveSpeed,Math.abs(this.endPos.x-this.object.x)>this.bounceDist&&(this.object.x=this.endPos.x+this.bounceDir.x*this.bounceDist,this.bounces++,this.bounces<5?(this.bounceDir.x*=-1,this.bounceDist-=1):this.state=AnimationState.DONE)):(this.object.y+=this.bounceDir.y*this.moveSpeed,Math.abs(this.endPos.y-this.object.y)>this.bounceDist&&(this.object.y=this.endPos.y+this.bounceDir.y*this.bounceDist,this.bounces++,this.bounces<5?(this.bounceDir.y*=-1,this.bounceDist-=1):this.state=AnimationState.DONE));break;case AnimationType.SCALE_IN:this.object.scale.setTo(this.object.scale.x+this.bounceDir*this.scaleSpeed/2,this.object.scale.y+this.bounceDir*this.scaleSpeed/2),Math.abs(this.endScale.x-this.object.scale.x)>this.bounceDist&&(this.object.scale.setTo(this.endScale.x+this.bounceDir*this.bounceDist,this.endScale.y+this.bounceDir*this.bounceDist),this.bounces++,this.bounces<SCALE_BOUNCE_TOTAL?this.bounceDir*=-1:this.state=AnimationState.DONE)}this.state==AnimationState.DONE&&(null!=this.nextAnimation&&(this.nextAnimation.state=AnimationState.ON),null!=this.callback&&this.callback(),null!=this.soundType&&audio.playSound(this.soundType),this.state=AnimationState.OVER)}}var VOICE_ADJ=.5;SoundType={WIN:0,CLICK:1,DELETE_DISTRICT:2,VOICE_AH:3,VOICE_AHH:4,VOICE_CHUCKLE:5,VOICE_HUH:6,VOICE_QUESTION:7,VOICE_QUESTION_2:8,WHOOSH:9,POP:10};class Audio{constructor(){this.music=new Phaser.Sound(game,"music",.5,!0),this.win=game.add.audio("winSound"),this.click=game.add.audio("clickSound"),this.delete=game.add.audio("snipSound"),this.voiceAh=game.add.audio("voiceAh"),this.voiceAh.volume=VOICE_ADJ,this.voiceAhh=game.add.audio("voiceAhh"),this.voiceAhh.volume=VOICE_ADJ,this.voiceChuckle=game.add.audio("voiceChuckle"),this.voiceChuckle.volume=VOICE_ADJ,this.voiceHuh=game.add.audio("voiceHuh"),this.voiceHuh.volume=VOICE_ADJ,this.voiceQuestion=game.add.audio("voiceQuestion"),this.voiceQuestion.volume=VOICE_ADJ,this.voiceQuestion2=game.add.audio("voiceQuestion2"),this.voiceQuestion2.volume=VOICE_ADJ,this.whoosh=game.add.audio("whooshSound"),this.pop=game.add.audio("popSound"),this.on=!0}startMusic(){this.music.play()}playSound(type){if(this.on)switch(type){case SoundType.WIN:this.win.play();break;case SoundType.CLICK:this.click.play();break;case SoundType.DELETE_DISTRICT:this.delete.play();break;case SoundType.VOICE_AH:this.voiceAh.play();break;case SoundType.VOICE_AHH:this.voiceAhh.play();break;case SoundType.VOICE_CHUCKLE:this.voiceChuckle.play();break;case SoundType.VOICE_HUH:this.voiceHuh.play();break;case SoundType.VOICE_QUESTION:this.voiceQuestion.play();break;case SoundType.VOICE_QUESTION_2:this.voiceQuestion2.play();break;case SoundType.WHOOSH:this.whoosh.play();break;case SoundType.POP:this.pop.play()}}onOff(){this.on?(settings.toggleAudioButton(!1),this.on=!1,this.music.pause()):(settings.toggleAudioButton(!0),this.on=!0,audio.playSound(SoundType.CLICK),this.music.resume())}}var HELP_STRING="Help us find your rep by entering info",NOT_FOUND="We didn't fine that address - try again!",BACK_TO_GAME="OK BACK TO THE GAME!";class CallToAction{constructor(){this.group=game.add.group(),this.bg=game.add.sprite(0,0,"splash_bg"),this.bg.width=gameWidth,this.bg.height=gameHeight,this.group.add(this.bg),this.box=game.add.sprite(0,0,"spritesheet1","Speech_Big"),this.box.anchor.setTo(.5,.5),this.box.scale.setTo(2.1*SCALE,2*SCALE),this.box.x=gameWidth/2,this.box.y=-this.box.height/2,this.group.add(this.box);var style={font:"24px "+MONT_FONT,fill:"#000000",align:"center"};this.headerText=game.add.text(0,0,"You can help!",style),this.headerText.anchor.setTo(.5,.5),this.headerText.x=gameWidth/2,this.headerText.y=.11*gameHeight,this.headerText.alpha=0,this.group.add(this.headerText),style={font:"16px "+MONT_FONT,fill:"#472733",align:"center"},this.subheader=game.add.text(0,0,"(Don't worry no data is collected)",style),this.subheader.anchor.setTo(.5,.5),this.subheader.x=gameWidth/2,this.subheader.y=.46*gameHeight,this.subheader.alpha=0,this.group.add(this.subheader),style={font:"32px "+MONT_FONT,fill:"#472733",align:"center"},this.repText=game.add.text(0,0,"",style),this.repText.anchor.setTo(.5,.5),this.repText.x=gameWidth/2,this.repText.y=.2*gameHeight,this.repText.alpha=0,this.group.add(this.repText),style={font:"18px "+MONT_FONT,fill:"#472733",align:"center"},this.repStateText=game.add.text(0,0,"",style),this.repStateText.anchor.setTo(.5,.5),this.repStateText.x=gameWidth/2,this.repStateText.y=.25*gameHeight,this.repStateText.alpha=0,this.group.add(this.repStateText),this.phone=game.add.sprite(0,0,"spritesheet1","phone_icon"),this.phone.scale.setTo(scale.x,scale.x),this.phone.anchor.setTo(.5,.5),this.phone.x=.35*gameWidth,this.phone.y=.35*gameHeight,this.phone.alpha=0,this.group.add(this.phone),style={font:"32px "+MONT_FONT,fill:"#472733",align:"center"},this.phoneText=game.add.text(0,0,"",style),this.phoneText.anchor.setTo(.5,.5),this.phoneText.x=.525*gameWidth,this.phoneText.y=.35*gameHeight,this.phoneText.alpha=0,this.group.add(this.phoneText),style={font:"24px "+MONT_FONT,fill:"#472733",align:"center",wordWrap:!0,wordWrapWidth:this.box.width-40},this.text=game.add.text(0,0,"",style),this.text.anchor.setTo(.5,.5),this.text.x=this.box.x,this.text.y=.6*this.box.height,this.text.text="If you don't think manipulating districts to swing the vote is fair, let your rep know! Ready?",this.text.alpha=0,this.group.add(this.text),this.gerry=game.add.sprite(0,0,"spritesheet1","gerry_idle"),this.gerry.anchor.setTo(.5,.5),this.gerry.x=.5*gameWidth,this.gerry.y=gameHeight+this.gerry.height/2,this.group.add(this.gerry),this.getRepsButton=game.add.button(0,0,"buttonSpriteSheet2",this.getStateReps.bind(this),this,1,2,0,2),this.getRepsButton.input.useHandCursor=!1,this.getRepsButton.anchor.setTo(.5,.5),this.getRepsButton.scale.setTo(1.5*SCALE,1.5*SCALE),this.getRepsButton.x=.5*gameWidth,this.getRepsButton.y=gameHeight+this.getRepsButton.height/2,this.group.add(this.getRepsButton),this.skipButton=game.add.button(0,0,"",this.deactivate.bind(this)),this.skipButton.input.useHandCursor=!1,this.skipButton.anchor.setTo(.5,.5),this.skipButton.width=160,this.skipButton.height=50,this.skipButton.x=gameWidth/2,this.skipButton.y=gameHeight+this.skipButton.height,this.skipButton.alpha=0,this.group.add(this.skipButton),style={font:"28px "+PHOS_FONT,fill:"#999999",align:"center"},this.skipText=game.add.text(0,0,SKIP_TEXT,style),this.skipText.anchor.setTo(.5,.5),this.skipText.x=this.skipButton.x,this.skipText.y=gameHeight-this.skipButton.height/2,this.skipText.alpha=0,this.group.add(this.skipText),this.fieldGroup=game.add.group(),this.address1=game.add.inputField(.19*gameWidth,.15*gameHeight,{font:"24px "+MONT_FONT,width:.6*gameWidth,padding:8,borderWidth:3,borderColor:"#000000",borderRadius:6,placeHolder:"Enter your address line 1"}),this.address1.alpha=0,this.fieldGroup.add(this.address1),this.address2=game.add.inputField(.19*gameWidth,.24*gameHeight,{font:"24px "+MONT_FONT,width:.6*gameWidth,padding:8,borderWidth:3,borderColor:"#000000",borderRadius:6,placeHolder:"Enter your address line 2"}),this.address2.alpha=0,this.fieldGroup.add(this.address2),this.city=game.add.inputField(.19*gameWidth,.33*gameHeight,{font:"24px "+MONT_FONT,width:.325*gameWidth,padding:8,borderWidth:3,borderColor:"#000000",borderRadius:6,placeHolder:"Enter your city"}),this.city.alpha=0,this.fieldGroup.add(this.city),this.stateInput=game.add.inputField(.545*gameWidth,.33*gameHeight,{font:"24px "+MONT_FONT,width:.075*gameWidth,padding:8,borderWidth:3,borderColor:"#000000",borderRadius:6,placeHolder:"State"}),this.stateInput.alpha=0,this.fieldGroup.add(this.stateInput),this.zip=game.add.inputField(.65*gameWidth,.33*gameHeight,{font:"24px "+MONT_FONT,width:.14*gameWidth,padding:8,borderWidth:3,borderColor:"#000000",borderRadius:6,placeHolder:"Zip Code"}),this.zip.alpha=0,this.fieldGroup.add(this.zip),this.activate()}activate(){document.addEventListener("keyup",this.onKeyUp.bind(this)),gameMode=GameMode.CALL_TO_ACTION,this.state=0,this.createAnimations()}deactivate(){document.removeEventListener("keyup",this.onKeyUp.bind(this));for(i=0;i<this.group.children.length;i++)this.group.children[i].alpha=0;for(var i=0;i<this.fieldGroup.children.length;i++)this.fieldGroup.children[i].x+=gameWidth;this.hideSkipButton(),this.hideGetRepsButton(),gameMode=GameMode.PLAY,removeLevelElements(),generateLevel()}createAnimations(){this.animations=[];var animation=new Animation(this.gerry,AnimationType.MOVE,new Phaser.Point(this.gerry.x,this.gerry.y),new Phaser.Point(this.gerry.x,gameHeight-this.gerry.height/2),0,0,null,null,ANIM_IN_SPEED,0,0,0,!1,!1);this.animations.push(animation),animation=new Animation(this.box,AnimationType.MOVE,new Phaser.Point(this.box.x,this.box.y),new Phaser.Point(this.box.x,.6*this.box.height),0,0,null,null,4*ANIM_IN_SPEED,0,0,0,!1,!1),this.animations.push(animation),this.animations[this.animations.length-2].setNextAnimation(animation),animation=new Animation(this.headerText,AnimationType.FADE_IN,null,null,0,0,null,null,0,0,2*FADE_IN_SPEED,0,!1,!1),this.animations.push(animation),this.animations[this.animations.length-2].setNextAnimation(animation),animation=new Animation(this.text,AnimationType.FADE_IN,null,null,0,0,null,null,0,0,2*FADE_IN_SPEED,0,!1,!1),this.animations.push(animation),this.animations[this.animations.length-2].setNextAnimation(animation);var callback=this.createAnimations2.bind(this);animation.setCallback(callback),this.animations[0].state=AnimationState.ON}createAnimations2(){this.animations=[];var animation=new Animation(this.gerry,AnimationType.MOVE,new Phaser.Point(this.gerry.x,this.gerry.y),new Phaser.Point(this.gerry.x,.64*gameHeight),0,0,null,null,ANIM_IN_SPEED,0,0,0,!1,!1);this.animations.push(animation),animation.state=AnimationState.ON,animation=new Animation(this.getRepsButton,AnimationType.MOVE,new Phaser.Point(this.getRepsButton.x,this.getRepsButton.y),new Phaser.Point(this.getRepsButton.x,.85*gameHeight),0,0,null,null,ANIM_IN_SPEED,0,0,0,!1,!1),this.animations.push(animation),animation.state=AnimationState.ON,animation=new Animation(this.skipButton,AnimationType.MOVE,new Phaser.Point(this.skipButton.x,this.skipButton.y),new Phaser.Point(this.skipButton.x,gameHeight-this.skipButton.height/2),0,0,null,null,ANIM_IN_SPEED,0,0,0,!1,!1),this.animations.push(animation),this.animations[this.animations.length-2].setNextAnimation(animation),animation=new Animation(this.skipText,AnimationType.FADE_IN,null,null,0,0,null,null,0,0,2*FADE_IN_SPEED,0,!1,!1),this.animations.push(animation),this.animations[this.animations.length-2].setNextAnimation(animation)}lookupZip(){var xhr=new XMLHttpRequest;xhr.open("GET","https://us-zipcode.api.smartystreets.com/lookup?auth-id=8660c680-a964-2e92-ebe7-9791d2e5a235&auth-token=tUlg9j7quI6rz3xIfC3e&city="+city.value+"&state="+state.value,!0),xhr.setRequestHeader("Content-type","application/json"),xhr.onload=function(e){if(4===xhr.readyState)if(200===xhr.status){if(null!=xhr.responseText){var jsonZipList=JSON.parse(xhr.responseText);null!=jsonZipList&&null!=jsonZipList[0].zipcodes&&(this.zip.value=jsonZipList[0].zipcodes[0].zipcode),""!=this.address1.value&&""!=this.city.value&&"State"!=this.state.value&&""!=this.zip.value&&(this.state=1)}}else console.error(xhr.statusText)},xhr.onerror=function(e){console.error(xhr.statusText)},xhr.send()}getStateReps(){switch(audio.playSound(SoundType.CLICK),this.state){case 0:this.address1.alpha=1,this.address2.alpha=1,this.city.alpha=1,this.stateInput.alpha=1,this.zip.alpha=1,this.text.alpha=0,this.headerText.text=HELP_STRING,this.subheader.alpha=1,this.state=1;break;case 1:if(""!=this.address1&&""!=this.city.value&&""!=this.stateInput.value&&""!=this.zip.value){this.headerText.text="One moment please...";var callback=this.startGetStateReps.bind(this);gapi.load("client",callback),this.address1.alpha=0,this.address2.alpha=0,this.city.alpha=0,this.stateInput.alpha=0,this.zip.alpha=0,this.subheader.alpha=0}break;case 2:window.open(window.location.href="tel:"+this.repPhone)}}startGetStateReps(){var address={address:this.address1.value+" "+this.city.value+" "+this.stateInput.value+" "+this.zip.value},url="https://www.googleapis.com/civicinfo/v2/representatives?key=AIzaSyCZMZJjEenGrcaVR1OLOmmRJtta0dUAVbU&address="+encodeURIComponent(JSON.stringify(address)),xhr=new XMLHttpRequest;xhr.open("GET",url,!0),xhr.onload=function(e){if(4===xhr.readyState)if(200===xhr.status){var jsonRepList=JSON.parse(xhr.responseText);if(null!=jsonRepList){for(var senateIndices=jsonRepList.offices[2].officialIndices,repIndices=jsonRepList.offices[3].officialIndices,senate=[],reps=[],i=0;i<senateIndices.length;i++)senate.push(jsonRepList.officials[senateIndices[i]]);for(i=0;i<repIndices.length;i++)reps.push(jsonRepList.officials[repIndices[i]]);this.headerText.text="Give a call and let your rep know",this.subheader.text='"I am not in favor of partisan gerrymandering!"',this.subheader.alpha=1,this.repText.text="("+reps[0].party[0]+") "+reps[0].name,"R"==this.repText.text[1]?this.repText.addColor(RED_HEX_STRING,0):this.repText.addColor(BLUE_HEX_STRING,0),this.repText.addColor("#000000",3),this.repText.alpha=1,this.repStateText.text="Rep for "+this.city.value+" of "+this.stateInput.value,this.repStateText.alpha=1,this.phone.alpha=1,this.phoneText.text=reps[0].phones[0],this.phoneText.alpha=1,this.repPhone=reps[0].phones[0],this.state=2,this.getRepsButton.setFrames(4,5,3,5),this.skipText.text=BACK_TO_GAME,gtag("event","call-to-action",{location:this.city.value+","+this.stateInput.value})}}else resetInputForm()}.bind(this),xhr.onerror=function(e){this.resetInputForm()},xhr.send(null)}resetInputForm(){this.headerText.text=NOT_FOUND,this.address1.alpha=1,this.address2.alpha=1,this.city.alpha=1,this.stateInput.alpha=1,this.zip.alpha=1,this.subheader.alpha=1}onKeyUp(event){"Tab"!=event.code&&"Enter"!=event.code||(this.address1.focus?(this.address1.endFocus(),this.address2.startFocus()):this.address2.focus?(this.address2.endFocus(),this.city.startFocus()):this.city.focus?(this.city.endFocus(),this.stateInput.startFocus()):this.stateInput.focus?(this.stateInput.endFocus(),this.zip.startFocus()):this.zip.focus&&(this.zip.endFocus(),this.address1.startFocus()))}reset(){this.bg.alpha=1,this.box.y=-this.box.height/2,this.box.alpha=1,this.gerry.y=gameHeight+this.gerry.height/2,this.gerry.alpha=1,this.getRepsButton.y=gameHeight+this.getRepsButton.height/2,this.getRepsButton.alpha=1,this.getRepsButton.inputEnabled=!0,this.getRepsButton.setFrames(1,2,0,2),this.skipButton.y=gameHeight+this.skipButton.height/2,this.skipButton.alpha=1,this.skipButton.inputEnabled=!0,this.skipText.text=SKIP_TEXT;for(var i=0;i<this.fieldGroup.children.length;i++)this.fieldGroup.children[i].x-=gameWidth,this.fieldGroup.children[i].alpha=0;game.world.bringToTop(this.group),game.world.bringToTop(this.fieldGroup),this.activate()}hideGetRepsButton(){this.getRepsButton.inputEnabled=!1,this.getRepsButton.alpha=0}showGetRepsButton(){this.getRepsButton.inputEnabled=!0,this.getRepsButton.alpha=1}hideSkipButton(){this.skipButton.inputEnabled=!1,this.skipButton.alpha=0}showSkipButton(){this.skipButton.inputEnabled=!0,this.skipButton.alpha=1}}TileCorner={UL:0,UR:1,BL:2,BR:3};class Corner{constructor(x,y){this.ul=game.add.sprite(0,0,"spritesheet1","corner_tie"),this.ul.scale.setTo(SCALE*tileScaleMod,SCALE*tileScaleMod),this.ul.x=x-this.ul.width,this.ul.y=y,this.ul.alpha=0,levelGroup.add(this.ul),this.ur=game.add.sprite(0,0,"spritesheet1","corner_tie"),this.ur.scale.setTo(SCALE*tileScaleMod,SCALE*tileScaleMod),this.ur.x=x,this.ur.y=y,this.ur.alpha=0,levelGroup.add(this.ur),this.bl=game.add.sprite(0,0,"spritesheet1","corner_tie"),this.bl.scale.setTo(SCALE*tileScaleMod,SCALE*tileScaleMod),this.bl.x=x-this.bl.width,this.bl.y=y+this.bl.height,this.bl.alpha=0,levelGroup.add(this.bl),this.br=game.add.sprite(0,0,"spritesheet1","corner_tie"),this.br.scale.setTo(SCALE*tileScaleMod,SCALE*tileScaleMod),this.br.x=x,this.br.y=y+this.bl.height,this.br.alpha=0,levelGroup.add(this.br),this.groupIndex=-1}select(){this.ul&&(this.ul.alpha=1),this.ur&&(this.ur.alpha=1),this.bl&&(this.bl.alpha=1),this.br&&(this.br.alpha=1)}selectCorner(tileCorner,color,tileColor){var corner=null;switch(tileCorner){case TileCorner.UL:corner=this.ul;break;case TileCorner.UR:corner=this.ur;break;case TileCorner.BL:corner=this.bl;break;case TileCorner.BR:corner=this.br}if(null!=corner){switch(tileColor){case TileColor.RED:corner.loadTexture("spritesheet1","corner_red");break;case TileColor.BLUE:corner.loadTexture("spritesheet1","corner_blue");break;case TileColor.NONE:corner.loadTexture("spritesheet1","corner_tie")}corner.alpha=1}}deselectCorner(){this.ul.alpha=0,this.ur.alpha=0,this.bl.alpha=0,this.br.alpha=0}}var WAIT_TIME=3,DIALOG_TIME=8,NUDGE_TIME=5,NUDGE_RESPONSE_TIME=3;TextMode={NONE:0,NUDGE:1,NUDGE_RESPONSE:2,FACT:3,JOKE:4,TIP:5,ACTIVATING:6,DEACTIVATING:7};class Dialog{constructor(){this.textMode=TextMode.NONE,this.nextMode=TextMode.NONE,this.nudgeIndex=-1,this.tipIndex=-1,this.factIndex=-1,this.jokeIndex=-1,this.textTimer=0,this.box=game.add.nineSlice(5,5,"nineslice",null,275,125),this.box.anchor.setTo(0,1),this.box.tint=14540253,this.box.x=20;var boxWidth=this.box.width;this.box.scale.setTo(0,0);var style={font:"18px "+MONT_FONT,fill:"#000000",align:"start",wordWrap:!0,wordWrapWidth:boxWidth-20};this.text=game.add.text(0,0,"",style),this.text.alpha=0,this.prevTextAlpha=0,this.hold=!1,this.responding=!1,this.alt=!1,this.animations=[]}update(deltaTime){this.textTimer+=deltaTime;for(var i=0;i<this.animations.length;i++)this.animations[i].update();if(!this.hold)switch(this.textMode){case TextMode.NONE:if(this.textTimer>=WAIT_TIME){this.textTimer=0;switch(getRandomInt(0,2)){case 0:this.setFact();break;case 1:this.setTip();break;case 2:this.setJoke()}}break;case TextMode.NUDGE:this.textTimer>=NUDGE_TIME&&(this.textTimer=0,this.deactivate());break;case TextMode.NUDGE_RESPONSE:this.textTimer>=NUDGE_RESPONSE_TIME&&(this.textTimer=0,this.deactivate());break;case TextMode.FACT:case TextMode.TIP:case TextMode.JOKE:this.textTimer>DIALOG_TIME&&(this.textTimer=0,this.deactivate())}}setGameLocation(){this.box.y=375,this.text.x=this.box.x+25,this.text.y=this.box.y-120,this.text.alpha=this.prevTextAlpha}setWalkthroughLocation(){this.box.y=2*gameHeight,this.prevTextAlpha=this.text.alpha,this.text.alpha=0}setNudge(id,extraText){this.nextMode=TextMode.NUDGE,this.nudgeIndex=id;var nudgeStr=nudgesJSON.nudges[this.nudgeIndex].nudge;if(""!=extraText){var extraIndex=nudgeStr.indexOf("X");if(-1!=extraIndex){var newString=nudgeStr.substr(0,extraIndex)+extraText;nudgeStr.length>extraIndex&&(newString+=nudgeStr.substr(extraIndex+1,nudgeStr.length-extraIndex))}this.text.text=newString}else this.text.text=nudgeStr;1==this.nudgeIndex&&(this.hold=!0),this.activate()}setNudgeResponse(alt){this.textMode==TextMode.NUDGE&&(this.hold&&(this.hold=!1),this.alt=alt,this.responding=!0,this.deactivate())}setFact(){this.nextMode=TextMode.FACT;for(var nextIndex=getRandomInt(0,factsJSON.facts.length-1);nextIndex==this.factIndex;)nextIndex=getRandomInt(0,factsJSON.facts.length-1);this.factIndex=nextIndex,this.text.text=factsJSON.facts[this.factIndex].fact,this.activate()}setJoke(){this.nextMode=TextMode.JOKE;for(var nextIndex=getRandomInt(0,jokesJSON.jokes.length-1);nextIndex==this.jokeIndex;)nextIndex=getRandomInt(0,jokesJSON.jokes.length-1);this.jokeIndex=nextIndex,this.text.text=jokesJSON.jokes[this.jokeIndex].joke,this.activate(),gerryAnimation.startChuckle()}setTip(){this.nextMode=TextMode.TIP;for(var nextIndex=getRandomInt(0,tipsJSON.tips.length-1);nextIndex==this.tipIndex;)nextIndex=getRandomInt(0,tipsJSON.tips.length-1);this.tipIndex=nextIndex,this.text.text=tipsJSON.tips[this.tipIndex].tip,this.activate()}activate(){this.textMode=TextMode.ACTIVATING,this.animations=[];var animation=new Animation(this.box,AnimationType.SCALE_IN,null,null,0,0,new Phaser.Point(0,0),new Phaser.Point(1,1),0,0,0,.2,!0,!1);this.animations.push(animation),animation=new Animation(this.text,AnimationType.FADE_IN,null,null,0,0,null,null,0,0,FADE_IN_SPEED,0,!1,!1);var callback=this.finishActivate.bind(this);animation.setCallback(callback),this.animations.push(animation),this.animations[0].setNextAnimation(animation),this.animations[0].state=AnimationState.ON}finishActivate(){this.textMode=this.nextMode,this.textTimer=0}deactivate(){this.textMode=TextMode.DEACTIVATING,this.animations=[];var animation=new Animation(this.text,AnimationType.FADE_OUT,null,null,0,0,null,null,0,0,FADE_IN_SPEED,0,!1,!1);this.animations.push(animation),animation=new Animation(this.box,AnimationType.SCALE_OUT,null,null,0,0,new Phaser.Point(1,1),new Phaser.Point(0,0),0,0,0,.2,!1,!1);var callback=null;callback=this.responding?this.respond.bind(this):this.resetDialog.bind(this),animation.setCallback(callback),this.animations.push(animation),this.animations[0].setNextAnimation(animation),this.animations[0].state=AnimationState.ON}remove(){this.text.alpha=0,this.box.scale.setTo(0,0),this.textMode=TextMode.NONE}resetDialog(){this.textMode=TextMode.NONE,this.textTimer=0}respond(){this.responding=!1,this.nextMode=TextMode.NUDGE_RESPONSE,this.alt?this.text.text=nudgesJSON.nudges[this.nudgeIndex].altresponse:this.text.text=nudgesJSON.nudges[this.nudgeIndex].response,this.activate(),gerryAnimation.startThumbsUp()}}class Example{constructor(){this.group=game.add.group(),this.bg=game.add.sprite(0,0,"splash_bg"),this.bg.width=gameWidth,this.bg.height=gameHeight,this.group.add(this.bg),this.box=game.add.sprite(0,0,"spritesheet1","Speech_Big"),this.box.anchor.setTo(.5,.5),this.box.scale.setTo(2.1*SCALE,2*SCALE),this.box.x=gameWidth/2,this.box.y=-this.box.height/2,this.group.add(this.box);var style={font:"24px "+MONT_FONT,fill:"#888888",align:"center"};this.headerText=game.add.text(0,0,"",style),this.headerText.anchor.setTo(.5,.5),this.headerText.x=.5*gameWidth,this.headerText.y=.11*gameHeight,this.headerText.alpha=0,this.group.add(this.headerText),style={font:"18px "+MONT_FONT,fill:"#472733",align:"left",boundsAlignV:"top",wordWrap:!0,wordWrapWidth:.5*this.box.width},this.text=game.add.text(0,0,"",style),this.text.anchor.setTo(.5,.5),this.text.setTextBounds(0,0,.5*this.box.width,.75*this.box.height),this.text.x=.355*gameWidth,this.text.y=.215*gameWidth,this.text.alpha=0,this.group.add(this.text),this.graphic=game.add.sprite(0,0,""),this.graphic.anchor.setTo(.5,.5),this.graphic.scale.setTo(.75,.75),this.graphic.x=.675*gameWidth,this.graphic.y=.325*gameHeight,this.graphic.alpha=0,this.group.add(this.graphic),this.gerry=game.add.sprite(0,0,"spritesheet1","gerry_idle"),this.gerry.anchor.setTo(.5,.5),this.gerry.x=.5*gameWidth,this.gerry.y=gameHeight+this.gerry.height/2,this.group.add(this.gerry),this.nextButton=game.add.button(0,0,"buttonSpriteSheet2",this.deactivate.bind(this),this,1,2,0,2),this.nextButton.input.useHandCursor=!1,this.nextButton.anchor.setTo(.5,.5),this.nextButton.scale.setTo(1.5*SCALE,1.5*SCALE),this.nextButton.x=.5*gameWidth,this.nextButton.y=gameHeight+this.nextButton.height/2,this.group.add(this.nextButton),this.index=-1,this.activate()}activate(){gameMode=GameMode.EXAMPLE;for(var nextIndex=getRandomInt(0,examplesJSON.examples.length-1);nextIndex==this.index;)nextIndex=getRandomInt(0,examplesJSON.examples.length-1);this.index=nextIndex,this.headerText.text=examplesJSON.examples[this.index].title,this.text.text=examplesJSON.examples[this.index].text,this.graphic.loadTexture("spritesheet1",examplesJSON.examples[this.index].image),this.createAnimations()}deactivate(){audio.playSound(SoundType.CLICK);for(var i=0;i<this.group.children.length;i++)this.group.children[i].alpha=0;this.nextButton.inputEnabled=!1,gameMode=GameMode.PLAY,generateLevel()}createAnimations(){this.animations=[];var animation=new Animation(this.gerry,AnimationType.MOVE,new Phaser.Point(this.gerry.x,this.gerry.y),new Phaser.Point(this.gerry.x,gameHeight-this.gerry.height/2),0,0,null,null,ANIM_IN_SPEED,0,0,0,!1,!1);this.animations.push(animation),animation=new Animation(this.box,AnimationType.MOVE,new Phaser.Point(this.box.x,this.box.y),new Phaser.Point(this.box.x,.6*this.box.height),0,0,null,null,4*ANIM_IN_SPEED,0,0,0,!1,!1),this.animations.push(animation),this.animations[this.animations.length-2].setNextAnimation(animation),animation=new Animation(this.graphic,AnimationType.FADE_IN,null,null,0,0,null,null,0,0,2*FADE_IN_SPEED,0,!1,!1),this.animations.push(animation),this.animations[this.animations.length-2].setNextAnimation(animation),animation=new Animation(this.headerText,AnimationType.FADE_IN,null,null,0,0,null,null,0,0,2*FADE_IN_SPEED,0,!1,!1),this.animations.push(animation),this.animations[this.animations.length-2].setNextAnimation(animation),animation=new Animation(this.text,AnimationType.FADE_IN,null,null,0,0,null,null,0,0,2*FADE_IN_SPEED,0,!1,!1),this.animations.push(animation),this.animations[this.animations.length-2].setNextAnimation(animation);var callback=this.createAnimations2.bind(this);animation.setCallback(callback),this.animations[0].state=AnimationState.ON}createAnimations2(){this.animations=[];var animation=new Animation(this.gerry,AnimationType.MOVE,new Phaser.Point(this.gerry.x,this.gerry.y),new Phaser.Point(this.gerry.x,.64*gameHeight),0,0,null,null,ANIM_IN_SPEED,0,0,0,!1,!1);this.animations.push(animation),animation.state=AnimationState.ON,animation=new Animation(this.nextButton,AnimationType.MOVE,new Phaser.Point(this.nextButton.x,this.nextButton.y),new Phaser.Point(this.nextButton.x,.85*gameHeight),0,0,null,null,ANIM_IN_SPEED,0,0,0,!1,!1),this.animations.push(animation),animation.state=AnimationState.ON}reset(){this.bg.alpha=1,this.box.y=-this.box.height/2,this.box.alpha=1,this.gerry.y=gameHeight+this.gerry.height/2,this.gerry.alpha=1,this.nextButton.y=gameHeight+this.nextButton.height/2,this.nextButton.alpha=1,this.nextButton.inputEnabled=!0,game.world.bringToTop(this.group),this.activate()}}var GERRY_IDLE_TIME=3,GERRY_BLINK_TIME=.25,GERRY_WAIT_TIME=.3,GERRY_TRANSITION_TIME=.25,GERRY_POINT_TIME=1.5,GERRY_THUMBS_UP_TIME=2.5,GERRY_CHUCKLE_TIME=.25,GERRY_CHUCKLE_TRANSITION_TIME=.75,GERRY_IDLE_MIN_TIME=6,GERRY_IDLE_MAX_TIME=10;GerryAnimationState={IDLE:0,CHUCKLE_1:1,CHUCKLE_2:2,WAIT_1:3,WAIT_2:4,BLINK:5,THUMBS_UP:6,POINT:7,TRANSITION:8};class GerryAnimation{constructor(){this.state=GerryAnimationState.IDLE,this.timer=0,this.count=0,this.subcount=0,this.hold=!1,this.nextState=GerryAnimationState.IDLE,this.idleTime=getRandomDouble(GERRY_IDLE_MIN_TIME,GERRY_IDLE_MAX_TIME)}update(deltaTime){switch(this.timer+=deltaTime,this.state){case GerryAnimationState.IDLE:if(this.timer>this.idleTime){0==getRandomInt(0,1)?this.setState(GerryAnimationState.BLINK):this.startWait()}break;case GerryAnimationState.CHUCKLE_1:this.timer>GERRY_CHUCKLE_TIME&&this.setState(GerryAnimationState.CHUCKLE_2);break;case GerryAnimationState.CHUCKLE_2:this.timer>GERRY_CHUCKLE_TIME&&(this.count++,this.count>=this.chuckleCount?this.setState(GerryAnimationState.IDLE):this.setState(GerryAnimationState.CHUCKLE_1));break;case GerryAnimationState.WAIT_1:var waitTime=GERRY_WAIT_TIME;this.hold&&(waitTime*=5),this.timer>waitTime&&(this.hold=!1,this.setState(GerryAnimationState.WAIT_2));break;case GerryAnimationState.WAIT_2:this.timer>GERRY_WAIT_TIME&&(this.count++,this.count>=this.waitCount?(this.subcount++,this.subcount>1?this.setState(GerryAnimationState.IDLE):(this.hold=!0,this.count=0,this.continueWait())):this.setState(GerryAnimationState.WAIT_1));break;case GerryAnimationState.BLINK:this.timer>GERRY_BLINK_TIME&&this.setState(GerryAnimationState.IDLE);break;case GerryAnimationState.THUMBS_UP:this.timer>GERRY_THUMBS_UP_TIME&&this.setState(GerryAnimationState.IDLE);break;case GerryAnimationState.POINT:this.timer>GERRY_POINT_TIME&&this.setState(GerryAnimationState.IDLE);break;case GerryAnimationState.TRANSITION:this.timer>GERRY_TRANSITION_TIME&&this.setState(this.nextState)}}setState(state,nextState){switch(state){case GerryAnimationState.IDLE:this.idleTime=getRandomDouble(GERRY_IDLE_MIN_TIME,GERRY_IDLE_MAX_TIME),gerry.loadTexture("spritesheet1","gerry_idle");break;case GerryAnimationState.CHUCKLE_1:gerry.loadTexture("spritesheet1","gerry_chuckle1");break;case GerryAnimationState.CHUCKLE_2:gerry.loadTexture("spritesheet1","gerry_chuckle2");break;case GerryAnimationState.WAIT_1:this.state==GerryAnimationState.IDLE&&(this.count=0,this.subcount=0),gerry.loadTexture("spritesheet1","gerry_waiting1");break;case GerryAnimationState.WAIT_2:gerry.loadTexture("spritesheet1","gerry_waiting2");break;case GerryAnimationState.BLINK:gerry.loadTexture("spritesheet1","gerry_idle_blink");break;case GerryAnimationState.THUMBS_UP:gerry.loadTexture("spritesheet1","gerry_thumbsup");break;case GerryAnimationState.POINT:gerry.loadTexture("spritesheet1","gerry_point");break;case GerryAnimationState.TRANSITION:gerry.loadTexture("spritesheet1","gerry_transition"),this.nextState=nextState}this.state=state,this.timer=0}startWait(){audio.playSound(SoundType.VOICE_HUH),this.waitCount=getRandomInt(2,4),this.setState(GerryAnimationState.WAIT_1)}continueWait(){this.waitCount=getRandomInt(2,4),this.setState(GerryAnimationState.WAIT_1)}startChuckle(){audio.playSound(SoundType.VOICE_CHUCKLE),this.chuckleCount=getRandomInt(3,5),this.setState(GerryAnimationState.TRANSITION,GerryAnimationState.CHUCKLE_1),this.count=0}startPoint(){audio.playSound(SoundType.VOICE_QUESTION),this.setState(GerryAnimationState.POINT)}startThumbsUp(){audio.playSound(SoundType.VOICE_AHH),this.setState(GerryAnimationState.THUMBS_UP)}}LineSide={ALL:0,TOP:1,BOTTOM:2,LEFT:3,RIGHT:4};class Line{constructor(v,i,j){this.v=v,this.i=i,this.j=j,this.sprites=[];var sprite;0==v?((sprite=game.add.sprite(0,0,"spritesheet1","outline_tie")).scale.setTo(SCALE*tileScaleMod,SCALE*tileScaleMod),sprite.x=tileStartX+offset.x+i*sprite.width-102,sprite.y=TILE_START_Y+offset.y-sprite.height+j*sprite.width,sprite.alpha=0,this.sprites.push(sprite),(sprite=game.add.sprite(0,0,"spritesheet1","outline_tie")).scale.setTo(SCALE*tileScaleMod,SCALE*tileScaleMod),sprite.x=tileStartX+offset.x+i*sprite.width-102,sprite.y=TILE_START_Y+offset.y+j*sprite.width,sprite.alpha=0,this.sprites.push(sprite)):((sprite=game.add.sprite(0,0,"spritesheet1","outline_tie_v")).scale.setTo(SCALE*tileScaleMod,SCALE*tileScaleMod),sprite.x=tileStartX+offset.x-sprite.width+j*sprite.height-102,sprite.y=TILE_START_Y+offset.y+i*sprite.height,sprite.alpha=0,this.sprites.push(sprite),(sprite=game.add.sprite(0,0,"spritesheet1","outline_tie_v")).scale.setTo(SCALE*tileScaleMod,SCALE*tileScaleMod),sprite.x=tileStartX+offset.x+j*sprite.height-102,sprite.y=TILE_START_Y+offset.y+i*sprite.height,sprite.alpha=0,this.sprites.push(sprite)),gameMode==GameMode.WALKTHROUGH&&(this.sprites[0].x-=WALKTHROUGH_X_ADJ,this.sprites[1].x-=WALKTHROUGH_X_ADJ),levelGroup.add(this.sprites[0]),levelGroup.add(this.sprites[1]),this.on=!1,this.sprites[0].line=this,this.sprites[1].line=this}setColor(color,lineSide){var sideIndex=0;lineSide!=LineSide.TOP&&lineSide!=LineSide.LEFT||(sideIndex=1),this.v?color==TileColor.RED?this.sprites[sideIndex].loadTexture("spritesheet1","outline_red_v"):color==TileColor.BLUE?this.sprites[sideIndex].loadTexture("spritesheet1","outline_blue_v"):this.sprites[sideIndex].loadTexture("spritesheet1","outline_tie_v"):color==TileColor.RED?this.sprites[sideIndex].loadTexture("spritesheet1","outline_red"):color==TileColor.BLUE?this.sprites[sideIndex].loadTexture("spritesheet1","outline_blue"):this.sprites[sideIndex].loadTexture("spritesheet1","outline_tie")}selectLine(lineSide,color){var sideIndex=0;if(lineSide!=LineSide.TOP&&lineSide!=LineSide.LEFT||(sideIndex=1),this.sprites[sideIndex].alpha=1,this.v)switch(color){case TileColor.NONE:this.sprites[sideIndex].loadTexture("spritesheet1","outline_tie_v");break;case TileColor.RED:this.sprites[sideIndex].loadTexture("spritesheet1","outline_red_v");break;case TileColor.BLUE:this.sprites[sideIndex].loadTexture("spritesheet1","outline_blue_v")}else switch(color){case TileColor.NONE:this.sprites[sideIndex].loadTexture("spritesheet1","outline_tie");break;case TileColor.RED:this.sprites[sideIndex].loadTexture("spritesheet1","outline_red");break;case TileColor.BLUE:this.sprites[sideIndex].loadTexture("spritesheet1","outline_blue")}this.on=!0}preview(lineSide){var sideIndex=0;lineSide!=LineSide.TOP&&lineSide!=LineSide.LEFT||(sideIndex=1),this.sprites[sideIndex].alpha=1,this.v?this.sprites[sideIndex].loadTexture("spritesheet1","outline_tie_v"):this.sprites[sideIndex].loadTexture("spritesheet1","outline_tie")}removePreview(lineSide){lineSide==LineSide.TOP||lineSide==LineSide.LEFT?this.sprites[0].alpha=0:this.sprites[1].alpha=0}deselectLine(lineSide){lineSide==LineSide.ALL&&(this.sprites[0].alpha=0,this.sprites[1].alpha=0),lineSide==LineSide.TOP||lineSide==LineSide.LEFT?this.sprites[0].alpha=0:this.sprites[1].alpha=0,this.on=!1}turnOffLineGraphics(lineSide){lineSide==LineSide.TOP||lineSide==LineSide.LEFT?this.sprites[1].alpha=0:this.sprites[0].alpha=0,0==this.sprites[0].alpha&&0==this.sprites[1].alpha&&(this.on=!1)}}var game,gameWidth,gameHeight,scale,tileScaleMod,tileStartX,splashTitle,splashPlayButton,gtLink,gtLinkButton,grid,gridWidth,gridHeight,usableWidth,usableHeight,tiles,tileWidth,tileIndexes,tileGap,startTile,currentTile,gerry,hLines,vLines,currentLines,boardBG,groups,currentGroup,currentSelectGroup,groupIndexes,levelData,levelCount,levelGroup,maxLevels,currentLevelIndex,districtSize,gameMode,prevGameMode,playerCountyCount,opponentCountyCount,playerDistrictCount,opponentDistrictCount,tieDistrictCount,numberOfWinnableDistricts,offset,selecting,startMoveDate,moveTime,noMoveTime,noMove,emptyTiles,previewAlphaDir,startInputPosition,playerColor,opponentColor,stars,starCount,vConnectors,hConnectors,connectorGroup,corners,patterns,patternTypeIndex,patternIndex,currentPattern,patternTypes,currentPatternIndex,playerDistrictPercent,roundScore,highScore,totalScore,populationStatus,voteStatus,roundScoreText,totalScoreText,instructionText,levelText,teamText,tutorialDown,backdrop,tutorialSpeechBubble,tutorialGroup,patternsJSON,nudgesJSON,factsJSON,jokesJSON,tipsJSON,walkthroughsJSON,examplesJSON,doneButton,repsButton,oldRoundScore,oldTotalScore,scoreMultiplier,animations,settings,dialog,callToAction,audio,walkthrough,share,gerryAnimation,results,goToCTA,DEBUG=!1,DEFAULT_WIDTH=800,DEFAULT_HEIGHT=534,TILE_GAP=43,SCALE=.267,GAMEPLAY_WIDTH=470,GAMEPLAY_HEIGHT=475,CLICK_TIME=150,RED_HEX=16652092,BLUE_HEX=3506941,RED_LIGHT_HEX=16209776,BLUE_LIGHT_HEX=7842814,RED_HEX_STRING="#fe173c",BLUE_HEX_STRING="#3582fd",ANIM_IN_SPEED=25,ANIM_OUT_SPEED=50,FADE_IN_SPEED=.05,FADE_OUT_SPEED=.1,SCALE_IN_SPEED=.1,WALKTHROUGH_X_ADJ=158,STAR_PARTICLE_SCALE=.25,NO_MOVE_TIME=32,DELETE_DIFF=15,MONT_FONT="Montserrat",PHOS_FONT="phosphate_prosolid",lastDate=null,fontLoaded=!1;GameMode={PLAY:0,MOVE:1,WIN:2,WALKTHROUGH:3,TUTORIAL:4,SHARE:5,CALL_TO_ACTION:6,EXAMPLE:7},gameWidth=DEFAULT_WIDTH,gameHeight=DEFAULT_HEIGHT,scale=new Phaser.Point(.5,.5),window.onload=function(){declareGame()},WebFontConfig={active:function(){game.time.events.add(Phaser.Timer.SECOND,onFontLoaded,this)},google:{families:["Montserrat"]}};var bootState={preload:function(){game.load.image("gtLink","assets/images/gtLink.png")},create:function(){game.state.start("preload")}},preloadState={preload:function(){var lightLogo=game.add.sprite(0,0,"gtLink");lightLogo.x=gameWidth/2-lightLogo.width/2,lightLogo.y=gameHeight/2-lightLogo.height/2,lightLogo.alpha=.1;var logo=game.add.sprite(lightLogo.x,lightLogo.y,"gtLink");this.load.setPreloadSprite(logo),game.load.json("levels","assets/levels.json"),game.load.json("patterns","assets/patterns.json"),game.load.json("nudges","assets/nudges.json"),game.load.json("walkthroughs","assets/walkthroughs.json"),game.load.json("facts","assets/facts.json"),game.load.json("examples","assets/examples.json"),game.load.json("jokes","assets/jokes.json"),game.load.json("tips","assets/tips.json"),game.load.atlas("spritesheet1","assets/atlases/gerrySpritesheet-0.png","assets/atlases/gerrySpritesheet-0.json"),game.load.spritesheet("buttonSpriteSheet1","assets/images/Button_Sprites_1.png",488,148,6),game.load.spritesheet("buttonSpriteSheet2","assets/images/Button_Sprites_2.png",488,148,6),game.load.spritesheet("fbButtonSheet","assets/images/facebookbutton.png",224,224,3),game.load.spritesheet("twitterButtonSheet","assets/images/twitterbutton.png",224,224,3),game.load.spritesheet("phoneButtonSheet","assets/images/phonebutton.png",224,224,3),game.load.spritesheet("closeButtonSheet","assets/images/xbutton.png",140,140,3),game.load.spritesheet("gtLinkSpriteSheet","assets/images/gtLinkSpriteSheet.png",486,42,3),game.load.nineSlice("nineslice","assets/images/Scale9_AllRounded.png",10),game.load.image("splash_bg","assets/images/splash_bg.jpg"),game.load.image("share","assets/images/Icon_Social.png"),game.load.image("audioOn","assets/images/sound_on.png"),game.load.image("help","assets/images/Icon_Help.png"),game.load.image("star","assets/images/Star.png"),game.load.image("redCursor","assets/images/hand_red.png"),game.load.image("blueCursor","assets/images/hand_blue.png"),game.load.image("bigBox","assets/images/Speech_Big.png"),game.load.image("phone","assets/images/phone_icon.png"),game.load.image("shareBox","assets/images/Speech_Tiny.png"),game.load.audio("music","assets/audio/bgMusic.mp3"),game.load.audio("winSound","assets/audio/win.mp3"),game.load.audio("clickSound","assets/audio/click.mp3"),game.load.audio("snipSound","assets/audio/scissors.mp3"),game.load.audio("whooshSound","assets/audio/whoosh.mp3"),game.load.audio("voiceAh","assets/audio/voiceAh.mp3"),game.load.audio("voiceAhh","assets/audio/voiceAhh.mp3"),game.load.audio("voiceChuckle","assets/audio/voiceChuckle.mp3"),game.load.audio("voiceHuh","assets/audio/voiceHuh.mp3"),game.load.audio("voiceQuestion","assets/audio/voiceQuestion.mp3"),game.load.audio("voiceQuestion2","assets/audio/voiceQuestion2.mp3"),game.load.audio("popSound","assets/audio/pop.mp3")},create:function(){var style={font:"14px "+PHOS_FONT,fill:"#ffffff",align:"center"};game.add.text(50,50,"GAMETHEORYCO.COM",style).alpha=1,setTimeout(function(){game.state.start("start")},1e3)}},startState={preload:function(){game.load.script("webfont","//ajax.googleapis.com/ajax/libs/webfont/1.4.7/webfont.js")},create:function(){document.addEventListener("mousedown",setInputPosition);document.getElementsByTagName("canvas")[0].addEventListener("touchstart",setInputPosition,!1),game.canvas.style.cursor="url(assets/images/hand_grey.png), auto",game.stage.backgroundColor=16777215,audio=new Audio;var bg=game.add.sprite(0,0,"splash_bg");bg.alpha=.6,bg.width=gameWidth,bg.height=gameHeight,(splashTitle=game.add.sprite(0,0,"spritesheet1","Title")).scale.setTo(1.86*SCALE,1.86*SCALE),splashTitle.anchor.setTo(.5,.5),splashTitle.x=gameWidth/2,splashTitle.y=-splashTitle.height,(splashPlayButton=game.add.button(0,0,"buttonSpriteSheet1",function(){setUpRemoveAnimations()},this,4,5,3,5)).input.useHandCursor=!1,splashPlayButton.anchor.setTo(.5,.5),splashPlayButton.scale.setTo(scale.x,scale.y),splashPlayButton.x=gameWidth/2,splashPlayButton.y=gameHeight+splashPlayButton.height,(gtLinkButton=game.add.button(0,0,"gtLinkSpriteSheet",openGTLink,this,1,2,0,2)).input.useHandCursor=!1,gtLinkButton.anchor.setTo(.5,.5),gtLinkButton.scale.setTo(.5,.5),gtLinkButton.x=gameWidth/2,gtLinkButton.y=18,gtLinkButton.alpha=0;var style={font:"28px "+PHOS_FONT,fill:"#000000",align:"center"};(gtLink=game.add.text(0,0,"GAMETHEORYCO.COM",style)).font="32px Arial",gtLink.anchor.setTo(.5,.5),gtLink.x=gameWidth/2,gtLink.y=gtLink.height,gtLink.alpha=0,animations=[];var animation=new Animation(splashTitle,AnimationType.MOVE,new Phaser.Point(splashTitle.x,splashTitle.y),new Phaser.Point(splashTitle.x,.375*gameHeight),0,0,null,null,ANIM_IN_SPEED,0,0,0,!0,!1);animations.push(animation),animation=new Animation(splashPlayButton,AnimationType.MOVE,new Phaser.Point(splashPlayButton.x,splashPlayButton.y),new Phaser.Point(splashPlayButton.x,.8*gameHeight),0,0,null,null,ANIM_IN_SPEED,0,0,0,!0,!1),animations.push(animation),animations[0].setNextAnimation(animation),animation=new Animation(gtLinkButton,AnimationType.FADE_IN,null,null,0,0,null,null,0,0,FADE_IN_SPEED,0,!1,!1),animations.push(animation),animations[1].setNextAnimation(animation),animations[2].setCallback(tiltTitle),animations[0].state=AnimationState.ON},update:function(){if("inherit"==game.canvas.style.cursor&&(game.canvas.style.cursor="url(assets/images/hand_grey.png), auto"),fontLoaded)for(var i=0;i<animations.length;i++)animations[i].update()}},mainState={create:function(){audio.startMusic(),game.canvas.style.cursor="url(assets/images/hand_grey.png), auto";var bg=game.add.sprite(0,0,"splash_bg");bg.alpha=.6,bg.width=gameWidth,bg.height=gameHeight,(boardBG=game.add.sprite(0,0,"spritesheet1","Square_White")).width=.53*gameWidth,boardBG.height=.85*gameHeight,boardBG.y=.015*gameHeight;var style={font:"18px "+PHOS_FONT,fill:"#000000",boundsAlignH:"left",boundsAlignV:"middle"};(roundScoreText=game.add.text(0,0,"ROUND SCORE: 0",style)).x=.46*gameWidth,roundScoreText.y=.025*gameHeight,(totalScoreText=game.add.text(0,0,"TOTAL SCORE: 0",style)).anchor.setTo(1,0),totalScoreText.x=.95*gameWidth,totalScoreText.y=.025*gameHeight,style.font="48px "+PHOS_FONT,style.wordWrap=!1,levelText=game.add.text(.025*gameWidth,0,"",style),style.font="24px "+PHOS_FONT,style.fill=RED_HEX_STRING,(teamText=game.add.text(0,.125*gameHeight,"",style)).x=.115*gameWidth,teamText.anchor.setTo(.5,.5),patternsJSON=game.cache.getJSON("patterns"),nudgesJSON=game.cache.getJSON("nudges"),walkthroughsJSON=game.cache.getJSON("walkthroughs"),factsJSON=game.cache.getJSON("facts"),examplesJSON=game.cache.getJSON("examples"),jokesJSON=game.cache.getJSON("jokes"),tipsJSON=game.cache.getJSON("tips"),patternTypes=[],maxLevels=0;for(var i=0;i<patternsJSON.patterns.length;i++){maxLevels++;for(var type=patternsJSON.patterns[i].type,pattern=patternsJSON.patterns[i].pattern,foundType=!1,j=0;j<patternTypes.length;j++)if(patternTypes[j].type==type){patternTypes[j].addPattern(pattern),foundType=!0;break}if(!foundType){var patternType=new PatternType(patternsJSON.patterns[i].id,type,patternsJSON.patterns[i].width,patternsJSON.patterns[i].height);patternType.addPattern(pattern),patternTypes.push(patternType)}}if(populationStatus=new StatusInfo(110,"CITY'S POPULATION:"),voteStatus=new StatusInfo(170,"DISTRICT VOTES:"),doneButton=game.add.button(0,0,"buttonSpriteSheet1",submit,this,1,2,0,2),doneButton.input.useHandCursor=!1,doneButton.scale.setTo(.45,.45),doneButton.anchor.setTo(.5,.5),doneButton.x=.71*gameWidth,doneButton.y=gameHeight+doneButton.height/2,DEBUG){var debugNextButton=game.add.button(0,0,"redHouse",next);debugNextButton.input.useHandCursor=!1,debugNextButton.scale.setTo(SCALE,SCALE),debugNextButton.x=gameWidth-debugNextButton.width,debugNextButton.y=gameHeight-debugNextButton.height}currentLevelIndex=0,patternTypeIndex=0,patternIndex=0,currentPatternIndex=1,totalScore=0,highScore=0,patterns=[],example=null,connectorGroup=game.add.group(),tileStartX=gameWidth-GAMEPLAY_WIDTH,dialog=new Dialog,share=new Share,gerryAnimation=new GerryAnimation,settings=new Settings,gameMode=GameMode.WALKTHROUGH,generateLevel(),resetForWalkthrough(),startWalkthrough()},update:function(){var deltaTime=null;if(null!=lastDate&&(deltaTime=(new Date-lastDate)/1e3),lastDate=new Date,"url(assets/images/hand"!=game.canvas.style.cursor.toString().substring(0,23))switch(gameMode){case GameMode.PLAY:case GameMode.MOVE:playerColor==TileColor.RED?game.canvas.style.cursor="url(assets/images/hand_red.png), auto":game.canvas.style.cursor="url(assets/images/hand_blue.png), auto";break;default:game.canvas.style.cursor="url(assets/images/hand_grey.png), auto"}switch(gameMode){case GameMode.MOVE:if(null!=gerryAnimation&&gerryAnimation.update(deltaTime),moveTime=lastDate-startMoveDate,selecting)game.input.activePointer.isDown||onInputUp();else{startTile=currentTile;var groupIndex=findInGroup(currentTile);if(-1!=groupIndex){selecting=!0,currentSelectGroup=[],currentLines=[];for(i=0;i<groups[groupIndex].tiles.length;i++){var tile=groups[groupIndex].tiles[i];currentSelectGroup.push(tile.index),currentLines.push(tile.top),currentLines.push(tile.bottom),currentLines.push(tile.left),currentLines.push(tile.right)}}else startCreateDistrict(),setConnectors()}for(i=0;i<animations.length;i++)animations[i].update();break;case GameMode.TUTORIAL:!tutorialDown&&game.input.activePointer.isDown?(tutorialDown=!0,advanceTutorial()):tutorialDown&&!game.input.activePointer.isDown&&(tutorialDown=!1);break;case GameMode.SHARE:game.input.activePointer.isDown&&(share.fbButton.getBounds().contains(game.input.position.x,game.input.position.y)||share.twitterButton.getBounds().contains(game.input.position.x,game.input.position.y)||share.repsButton.getBounds().contains(game.input.position.x,game.input.position.y)||share.deactivate());break;case GameMode.WALKTHROUGH:walkthrough.update(deltaTime);break;case GameMode.EXAMPLE:for(i=0;i<example.animations.length;i++)example.animations[i].update();break;case GameMode.CALL_TO_ACTION:if(null!=callToAction){checkZip();for(i=0;i<callToAction.animations.length;i++)callToAction.animations[i].update()}break;case GameMode.WIN:if(null!=results){for(i=0;i<results.animations.length;i++)results.animations[i].update();if(null!=results.emitters&&results.emitters.length>0)for(i=0;i<results.emitters.length;i++)results.emitters[i].forEachAlive(function(p){p.alpha=p.lifespan/results.emitters[i].lifespan;var pScale=p.alpha*STAR_PARTICLE_SCALE;p.scale.setTo(pScale,pScale)})}break;default:noMoveTime+=deltaTime,!noMove&&noMoveTime>NO_MOVE_TIME&&playerDistrictCount+opponentDistrictCount+tieDistrictCount==0?(dialog.setNudge(1,""),findEmptyDistrict(),gerryAnimation.startPoint(),previewAlphaDir=1,noMoveTime=0,noMove=!0):noMove&&pulsePreview(deltaTime),null!=gerryAnimation&&gerryAnimation.update(deltaTime),null!=dialog&&dialog.update(deltaTime);for(var i=0;i<animations.length;i++)animations[i].update()}}};class PatternType{constructor(id,type,width,height){this.id=id,this.type=type,this.width=width,this.height=height,this.count=0,this.patterns=[]}addPattern(pattern){this.patterns.push(pattern),this.count++}getPattern(){var nextIndex=getRandomInt(0,this.patterns.length-1),pattern=this.patterns[nextIndex];return this.patterns.splice(nextIndex,1),pattern}getFirstPattern(){var pattern=this.patterns[0];return this.patterns.splice(0,1),pattern}}class Results{constructor(){this.group=game.add.group(),this.bg=game.add.sprite(0,0,"splash_bg"),this.bg.width=gameWidth,this.bg.height=gameHeight,this.group.add(this.bg);var style={font:"48px "+PHOS_FONT,fill:"#000000",boundsAlignH:"left",boundsAlignV:"middle"};this.levelText=game.add.text(0,0,"LEVEL "+currentLevelIndex,style),this.levelText.anchor.setTo(.5,.5),this.levelText.x=gameWidth/2,this.levelText.y=-this.levelText.height,this.group.add(this.levelText),this.bar=game.add.sprite(0,0,"spritesheet1","Square_White"),this.bar.tint=13421772,this.bar.anchor.setTo(.5,.5),this.bar.width=.35*gameWidth,this.bar.height=.01*gameHeight,this.bar.x=-this.bar.width,this.bar.y=225,this.group.add(this.bar),style.font="28px "+PHOS_FONT,this.roundScoreText=game.add.text(0,0,"ROUND SCORE: "+roundScore,style),this.roundScoreText.anchor.setTo(.5,.5),this.roundScoreText.x=gameWidth/2,this.roundScoreText.y=245,this.roundScoreText.alpha=0,this.group.add(this.roundScoreText),this.bar1=game.add.sprite(0,0,"spritesheet1","Square_White"),this.bar1.tint=13421772,this.bar1.anchor.setTo(.5,.5),this.bar1.width=.35*gameWidth,this.bar1.height=.01*gameHeight,this.bar1.x=gameWidth+this.bar1.width/2,this.bar1.y=265,this.group.add(this.bar1),style.font="24px "+PHOS_FONT,this.totalScoreText=game.add.text(0,0,"TOTAL SCORE: "+totalScore,style),this.totalScoreText.alpha=0,this.totalScoreText.anchor.setTo(.5,.5),this.totalScoreText.x=gameWidth/2,this.totalScoreText.y=300,this.group.add(this.totalScoreText),style.font="18px "+PHOS_FONT,this.highScoreText=game.add.text(0,0,"HIGH SCORE: "+highScore,style),this.highScoreText.alpha=0,this.highScoreText.anchor.setTo(.5,.5),this.highScoreText.x=gameWidth/2,this.highScoreText.y=350,this.group.add(this.highScoreText),this.gerry=game.add.sprite(0,0,"spritesheet1","gerry_idle"),this.gerry.anchor.setTo(.5,.5),this.gerry.scale.setTo(-1,1),this.gerry.x=.875*gameWidth,this.gerry.y=gameHeight+this.gerry.height,this.group.add(this.gerry),this.shareBoxButton=game.add.button(0,0,"shareBox",function(){activateShare("I got a round score of "+roundScore+" on level "+currentLevelIndex+" in #GerryMander at http://playgerrymander.com/game!",!0)}),this.shareBoxButton.input.useHandCursor=!1,this.shareBoxButton.anchor.setTo(.5,.5),this.shareBoxButton.scale.setTo(1.86*SCALE,1.86*SCALE),this.shareBoxButton.x=.875*gameWidth,this.shareBoxButton.y=.625*gameHeight,this.shareBoxButton.alpha=0,this.group.add(this.shareBoxButton),style.font="20px "+PHOS_FONT,this.shareText=game.add.text(0,0,"SHARE THIS",style),this.shareText.alpha=0,this.shareText.anchor.setTo(.5,.5),this.shareText.x=.855*gameWidth,this.shareText.y=.6055*gameHeight,this.group.add(this.shareText),this.shareIcon=game.add.image(0,0,"share"),this.shareIcon.alpha=0,this.shareIcon.anchor.setTo(.5,.5),this.shareIcon.scale.setTo(1.5*SCALE,1.5*SCALE),this.shareIcon.x=.935*gameWidth,this.shareIcon.y=.6*gameHeight,this.group.add(this.shareIcon),this.nextButton=game.add.button(0,0,"buttonSpriteSheet2",this.deactivateAndGoToNextLevel,this,1,2,0,2),this.nextButton.input.useHandCursor=!1,this.nextButton.anchor.setTo(.5,.5),this.nextButton.scale.setTo(.45,.45),this.nextButton.x=gameWidth/2,this.nextButton.y=gameHeight+this.nextButton.height/2,this.group.add(this.nextButton),this.createStars(),this.createAnimations(),this.active=!0}reactivate(){this.bg.alpha=1,this.gerry.loadTexture("spritesheet1","gerry_idle"),this.roundScoreText.text="ROUND SCORE: "+roundScore,this.totalScoreText.text="TOTAL SCORE: "+totalScore,this.highScoreText.text="HIGH SCORE: "+highScore,this.levelText.text="LEVEL "+currentLevelIndex,this.levelText.y=-this.levelText.height,this.levelText.alpha=1,this.bar.x=-this.bar.width,this.bar.alpha=1,this.bar1.x=gameWidth+this.bar1.width/2,this.bar1.alpha=1,this.gerry.y=gameHeight+this.gerry.height,this.gerry.alpha=1,this.nextButton.y=gameHeight+this.nextButton.height/2,this.nextButton.alpha=1,this.nextButton.inputEnabled=!0,game.world.bringToTop(this.group),this.createStars(),this.createAnimations(),this.active=!0}createStars(){this.blankStars=[];var star=game.add.sprite(0,0,"star");star.anchor.setTo(.5,.5),star.x=.4*gameWidth,star.y=.3*gameHeight,star.scale.setTo(0,0),this.blankStars.push(star),this.group.add(star),(star=game.add.sprite(0,0,"star")).anchor.setTo(.5,.5),star.x=.5*gameWidth,star.y=.3*gameHeight,star.scale.setTo(0,0),this.blankStars.push(star),this.group.add(star),(star=game.add.sprite(0,0,"star")).anchor.setTo(.5,.5),star.x=.6*gameWidth,star.y=.3*gameHeight,star.scale.setTo(0,0),this.blankStars.push(star),this.group.add(star);for(i=0;i<this.blankStars.length;i++)playerColor==TileColor.RED?this.blankStars[i].tint=RED_LIGHT_HEX:this.blankStars[i].tint=BLUE_LIGHT_HEX;this.winStars=[],this.emitters=[],(star=game.add.sprite(0,0,"star")).anchor.setTo(.5,.5),star.x=.4*gameWidth,star.y=.3*gameHeight,star.scale.setTo(0,0),this.winStars.push(star),this.group.add(star),starCount>1&&((star=game.add.sprite(0,0,"star")).anchor.setTo(.5,.5),star.x=.5*gameWidth,star.y=.3*gameHeight,star.scale.setTo(0,0),this.winStars.push(star),this.group.add(star)),starCount>2&&((star=game.add.sprite(0,0,"star")).anchor.setTo(.5,.5),star.x=.6*gameWidth,star.y=.3*gameHeight,star.scale.setTo(0,0),this.winStars.push(star),this.group.add(star));for(var i=0;i<this.winStars.length;i++)playerColor==TileColor.RED?this.winStars[i].tint=RED_HEX:this.winStars[i].tint=BLUE_HEX}createAnimations(){this.animations=[];var animation=new Animation(this.levelText,AnimationType.MOVE,new Phaser.Point(this.levelText.x,this.levelText.y),new Phaser.Point(this.levelText.x,.15*gameHeight),0,0,null,null,ANIM_IN_SPEED,0,0,0,!1,!1);this.animations.push(animation),(animation=new Animation(this.bar,AnimationType.MOVE,new Phaser.Point(this.bar.x,this.bar.y),new Phaser.Point(gameWidth/2,this.bar.y),0,0,null,null,4*ANIM_IN_SPEED,0,0,0,!1,!1)).setSound(SoundType.WHOOSH),this.animations.push(animation),this.animations[this.animations.length-2].setNextAnimation(animation),animation=new Animation(this.roundScoreText,AnimationType.FADE_IN,null,null,0,0,null,null,0,0,FADE_IN_SPEED,0,!1,!1),this.animations.push(animation),this.animations[this.animations.length-2].setNextAnimation(animation),(animation=new Animation(this.bar1,AnimationType.MOVE,new Phaser.Point(this.bar1.x,this.bar1.y),new Phaser.Point(gameWidth/2,this.bar1.y),0,0,null,null,4*ANIM_IN_SPEED,0,0,0,!1,!1)).setSound(SoundType.WHOOSH),this.animations.push(animation),this.animations[this.animations.length-2].setNextAnimation(animation),animation=new Animation(this.totalScoreText,AnimationType.FADE_IN,null,null,0,0,null,null,0,0,FADE_IN_SPEED,0,!1,!1),this.animations.push(animation),this.animations[this.animations.length-2].setNextAnimation(animation),animation=new Animation(this.highScoreText,AnimationType.FADE_IN,null,null,0,0,null,null,0,0,FADE_IN_SPEED,0,!1,!1),this.animations.push(animation),this.animations[this.animations.length-2].setNextAnimation(animation),animation=new Animation(this.gerry,AnimationType.MOVE,new Phaser.Point(this.gerry.x,this.gerry.y),new Phaser.Point(this.gerry.x,.85*gameHeight),0,0,null,null,ANIM_IN_SPEED,0,0,0,!1,!1),this.animations.push(animation),this.animations[this.animations.length-2].setNextAnimation(animation),animation=new Animation(this.shareBoxButton,AnimationType.FADE_IN,null,null,0,0,null,null,0,0,2*FADE_IN_SPEED,0,!1,!1),this.animations.push(animation),this.animations[this.animations.length-2].setNextAnimation(animation),animation=new Animation(this.shareText,AnimationType.FADE_IN,null,null,0,0,null,null,0,0,4*FADE_IN_SPEED,0,!1,!1),this.animations.push(animation),this.animations[this.animations.length-2].setNextAnimation(animation),animation=new Animation(this.shareIcon,AnimationType.FADE_IN,null,null,0,0,null,null,0,0,2*FADE_IN_SPEED,0,!1,!1),this.animations.push(animation),this.animations[this.animations.length-2].setNextAnimation(animation),animation=new Animation(this.nextButton,AnimationType.MOVE,new Phaser.Point(this.nextButton.x,this.nextButton.y),new Phaser.Point(this.nextButton.x,.85*gameHeight),0,0,null,null,ANIM_IN_SPEED,0,0,0,!0,!1);var callback=this.delayGerryVictorySound.bind(this);animation.setCallback(callback),this.animations.push(animation),this.animations[this.animations.length-2].setNextAnimation(animation);for(i=0;i<this.blankStars.length;i++)animation=new Animation(this.blankStars[i],AnimationType.SCALE_IN,null,null,0,0,new Phaser.Point(0,0),new Phaser.Point(scale.x,scale.y),0,0,0,SCALE_IN_SPEED,!1,!1),this.animations.push(animation),this.animations[this.animations.length-2].setNextAnimation(animation);scoreMultiplier=0,oldRoundScore=roundScore;for(var i=0;i<this.winStars.length;i++)animation=new Animation(this.winStars[i],AnimationType.SCALE_IN,null,null,0,0,new Phaser.Point(0,0),new Phaser.Point(scale.x,scale.y),0,0,0,SCALE_IN_SPEED,!1,!1),callback=this.multiplyScore.bind(this),animation.setCallback(callback),this.animations.push(animation),this.animations[this.animations.length-2].setNextAnimation(animation);this.animations[0].state=AnimationState.ON}multiplyScore(){audio.playSound(SoundType.POP),scoreMultiplier++;var emitter=game.add.emitter(0,0,100);emitter.gravity=1500,emitter.x=results.winStars[scoreMultiplier-1].x,emitter.y=results.winStars[scoreMultiplier-1].y,emitter.makeParticles("star"),emitter.minParticleSpeed.setTo(-500,-500),emitter.maxParticleSpeed.setTo(500,500),emitter.start(!0,4e3,null,10),emitter.forEach(function(particle){particle.scale.setTo(STAR_PARTICLE_SCALE),playerColor==TileColor.RED?particle.tint=RED_LIGHT_HEX:particle.tint=BLUE_LIGHT_HEX}),this.emitters.push(emitter),totalScore=oldTotalScore+(roundScore=oldRoundScore*scoreMultiplier),this.totalScoreText.text="TOTAL SCORE: "+totalScore,totalScore>highScore&&(highScore=totalScore,this.highScoreText.text="HIGH SCORE: "+highScore),this.roundScoreText.text="ROUND SCORE: "+roundScore}clearEmitters(){if(null!=this.emitters)for(var i=0;i<this.emitters.length;i++)this.emitters[i].destroy()}deactivateAndGoToNextLevel(){this.deactivate(),clickNextLevel()}deactivate(){for(var i=0;i<this.group.children.length;i++)this.group.children[i].alpha=0;this.nextButton.inputEnabled=!1,this.active=!1}enableNextButton(){this.active&&(this.nextButton.inputEnabled=!0)}disableNextButton(){this.active&&(this.nextButton.inputEnabled=!1)}enableShareButton(){this.active&&(this.shareBoxButton.inputEnabled=!0)}disableShareButton(){this.active&&(this.shareBoxButton.inputEnabled=!1)}delayGerryVictorySound(){var that=this;setTimeout(function(){that.gerry.loadTexture("spritesheet1","gerry_thumbsup"),audio.playSound(SoundType.VOICE_AHH)},1e3)}}class Settings{constructor(){this.bg=game.add.nineSlice(0,0,"nineslice",null,370,40),this.bg.tint=14540253,this.bg.x=-50,this.bg.y=.9*gameHeight,this.shareButton=game.add.button(0,0,"share",this.share),this.shareButton.input.useHandCursor=!1,this.shareButton.scale.setTo(1.5*SCALE,1.5*SCALE),this.shareButton.x=180,this.shareButton.y=.9*gameHeight,this.helpButton=game.add.button(0,0,"help",help),this.helpButton.input.useHandCursor=!1,this.helpButton.scale.setTo(1.5*SCALE,1.5*SCALE),this.helpButton.x=225,this.helpButton.y=.9*gameHeight,this.audioButton=game.add.button(0,0,"audioOn",audio.onOff.bind(audio)),this.audioButton.input.useHandCursor=!1,this.audioButton.scale.setTo(1.5*SCALE,1.5*SCALE),this.audioButton.x=270,this.audioButton.y=.9*gameHeight}share(){audio.playSound(SoundType.CLICK),activateShare("Playing GerryMander, a simple puzzle game designed to show how gerrymandering can be used to rig an election from @gametheoryco : http://playgerrymander.com/game.",!1)}hide(){this.bg.alpha=0,this.shareButton.alpha=0,this.helpButton.alpha=0,this.audioButton.alpha=0}show(){this.bg.alpha=1,this.shareButton.alpha=1,this.helpButton.alpha=1,this.audioButton.alpha=1}disableButtons(){this.shareButton.inputEnabled=!1,this.helpButton.inputEnabled=!1,this.audioButton.inputEnabled=!1}enableButtons(){null!=this.audioButton&&(this.audioButton.inputEnabled=!0),null!=this.helpButton&&(this.helpButton.inputEnabled=!0),null!=this.shareButton&&(this.shareButton.inputEnabled=!0)}toggleAudioButton(on){on?this.audioButton.loadTexture("audioOn"):this.audioButton.loadTexture("spritesheet1","sound_off")}}class Share{constructor(){this.group=game.add.group(),this.backdrop=game.add.sprite(0,0,"spritesheet1","Square_Black"),this.backdrop.width=gameWidth,this.backdrop.height=gameHeight,this.backdrop.alpha=0,this.group.add(this.backdrop),this.box=game.add.nineSlice(0,0,"nineslice",null,gameWidth/2,gameHeight/2),this.box.anchor.setTo(.5,.5),this.box.x=gameWidth/2,this.box.y=gameHeight/2,this.box.alpha=0,this.group.add(this.box),this.fbButton=game.add.button(0,0,"fbButtonSheet",this.fb.bind(this),this,1,2,0,2),this.fbButton.input.useHandCursor=!1,this.fbButton.scale.setTo(.5,.5),this.fbButton.anchor.setTo(.5,.5),this.fbButton.x=gameWidth/2-this.fbButton.width,this.fbButton.y=gameHeight/2,this.fbButton.alpha=0,this.fbButton.inputEnabled=!1,this.group.add(this.fbButton),this.twitterButton=game.add.button(0,0,"twitterButtonSheet",this.tweet.bind(this),this,1,2,0,2),this.twitterButton.input.useHandCursor=!1,this.twitterButton.scale.setTo(.5,.5),this.twitterButton.anchor.setTo(.5,.5),this.twitterButton.x=gameWidth/2,this.twitterButton.y=gameHeight/2,this.twitterButton.alpha=0,this.twitterButton.inputEnabled=!1,this.group.add(this.twitterButton),this.repsButton=game.add.button(0,0,"phoneButtonSheet",this.shareToReps,this,1,2,0,2),this.repsButton.input.useHandCursor=!1,this.repsButton.scale.setTo(.5,.5),this.repsButton.anchor.setTo(.5,.5),this.repsButton.x=gameWidth/2+this.repsButton.width,this.repsButton.y=gameHeight/2,this.repsButton.alpha=0,this.repsButton.inputEnabled=!1,this.group.add(this.repsButton),this.closeButton=game.add.button(0,0,"closeButtonSheet",this.deactivate.bind(this),this,1,2,0,2),this.closeButton.input.useHandCursor=!1,this.closeButton.scale.setTo(.5,.5),this.closeButton.anchor.setTo(.5,.5),this.closeButton.x=this.box.x+this.box.width/2,this.closeButton.y=this.box.y-this.box.height/2,this.closeButton.alpha=0,this.closeButton.inputEnabled=!1,this.group.add(this.closeButton)}activate(shareStr,fromResults){null!=results&&(results.disableShareButton(),results.disableNextButton()),settings.disableButtons(),prevGameMode=gameMode,gameMode=GameMode.SHARE,this.shareString=shareStr,deactivateDoneButton(),this.backdrop.alpha=.5,this.box.alpha=1,this.fbButton.alpha=1,this.fbButton.inputEnabled=!0,this.twitterButton.alpha=1,this.twitterButton.inputEnabled=!0,this.repsButton.alpha=1,this.repsButton.inputEnabled=!0,this.closeButton.alpha=1,this.closeButton.inputEnabled=!0,game.world.bringToTop(this.group),this.fromResults=fromResults}deactivate(){audio.playSound(SoundType.CLICK),prevGameMode==GameMode.WIN&&null!=results&&(results.enableShareButton(),results.enableNextButton()),reactivateButtons(),gameMode=prevGameMode,checkDoneButton(),this.backdrop.alpha=0,this.box.alpha=0,this.fbButton.alpha=0,this.fbButton.inputEnabled=!1,this.twitterButton.alpha=0,this.twitterButton.inputEnabled=!1,this.repsButton.alpha=0,this.repsButton.inputEnabled=!1,this.closeButton.alpha=0,this.closeButton.inputEnabled=!1}fb(){1==this.fbButton.alpha&&(gtag("event","fb-share"),audio.playSound(SoundType.CLICK),FB.ui({method:"share",href:"http://playgerrymander.com/game"},function(response){}))}tweet(){if(1==this.twitterButton.alpha){gtag("event","twitter-share"),audio.playSound(SoundType.CLICK);var finaltweet="http://twitter.com/home?status="+encodeURIComponent(this.shareString);window.open(finaltweet,"_blank","width=400,height=200,left=300,top=200")}}shareToReps(){1==this.repsButton.alpha&&(audio.playSound(SoundType.CLICK),this.fromResults?(results.deactivate(),this.deactivate(),goToCTA=!0,goToNextLevel()):reps())}}var STATUS_BAR_START_X=-300,STATUS_BAR_X=20,STATUS_BAR_WIDTH=300,STATUS_BAR_HEIGHT=20;class StatusInfo{constructor(y,title){var style={font:"18px "+PHOS_FONT,fill:"#000000",wordWrap:!0,wordWrapWidth:STATUS_BAR_WIDTH,align:"center"};this.text=game.add.text(0,y+15,title,style),this.text.anchor.set(.5),this.text.x=STATUS_BAR_START_X+this.text.width/2,this.bar=new Bar(y+25)}setWidths(playerPercent,opponentPercent,tiePercent){this.bar.setWidths(playerPercent,opponentPercent,tiePercent)}setBarTint(){this.bar.setTints()}}class Bar{constructor(y){this.playerBar=game.add.sprite(0,0,"spritesheet1","Square_White"),this.playerBar.width=0,this.playerBar.height=STATUS_BAR_HEIGHT,this.playerBar.x=STATUS_BAR_START_X,this.playerBar.y=y,this.opponentBar=game.add.sprite(0,0,"spritesheet1","Square_White"),this.opponentBar.width=0,this.opponentBar.height=STATUS_BAR_HEIGHT,this.opponentBar.y=y,this.tieBar=game.add.sprite(0,0,"spritesheet1","Square_White"),this.tieBar.width=0,this.tieBar.height=STATUS_BAR_HEIGHT,this.tieBar.y=y,this.tieBar.tint=13421772,this.noneBar=game.add.sprite(0,0,"spritesheet1","Square_White"),this.noneBar.width=STATUS_BAR_WIDTH,this.noneBar.height=STATUS_BAR_HEIGHT,this.noneBar.y=y,this.noneBar.tint=11184810}setTints(){playerColor==TileColor.RED?this.playerBar.tint=RED_HEX:this.playerBar.tint=BLUE_HEX,playerColor==TileColor.RED?this.opponentBar.tint=BLUE_HEX:this.opponentBar.tint=RED_HEX}setWidths(playerPercent,opponentPercent,tiePercent){this.playerBar.width=playerPercent*STATUS_BAR_WIDTH,gameMode==GameMode.WALKTHROUGH?this.opponentBar.x=STATUS_BAR_START_X+this.playerBar.width:this.opponentBar.x=STATUS_BAR_X+this.playerBar.width,this.opponentBar.width=opponentPercent*STATUS_BAR_WIDTH,this.tieBar.width=tiePercent*STATUS_BAR_WIDTH,gameMode==GameMode.WALKTHROUGH?this.tieBar.x=STATUS_BAR_START_X+this.playerBar.width+this.opponentBar.width:this.tieBar.x=STATUS_BAR_X+this.playerBar.width+this.opponentBar.width,this.noneBar.width=STATUS_BAR_WIDTH-(this.playerBar.width+this.opponentBar.width+this.tieBar.width),gameMode==GameMode.WALKTHROUGH?this.noneBar.x=STATUS_BAR_START_X+this.playerBar.width+this.opponentBar.width+this.tieBar.width:this.noneBar.x=STATUS_BAR_X+this.playerBar.width+this.opponentBar.width+this.tieBar.width}}var TILE_START_Y=-90;TileColor={NONE:0,RED:1,BLUE:2};class Tile{constructor(tileColor,i,j){switch(this.i=i,this.j=j,this.color=tileColor,this.color==playerColor?playerCountyCount++:this.color==opponentColor&&opponentCountyCount++,this.color){case TileColor.RED:this.bg=game.add.sprite(0,0,"spritesheet1","redtile"),this.sprite=usableWidth>=4&&usableHeight>=4?game.add.sprite(0,0,"spritesheet1","county_red_city"):game.add.sprite(0,0,"spritesheet1","county_red_house"),this.previewBG=game.add.sprite(0,0,"spritesheet1","Square_White"),levelGroup.add(this.previewBG);break;case TileColor.BLUE:this.bg=game.add.sprite(0,0,"spritesheet1","redtile"),this.sprite=usableWidth>=4&&usableHeight>=4?game.add.sprite(0,0,"spritesheet1","county_blue_city"):game.add.sprite(0,0,"spritesheet1","county_blue_house"),this.previewBG=game.add.sprite(0,0,"spritesheet1","Square_White"),levelGroup.add(this.previewBG);break;default:this.bg=game.add.sprite(0,0,"spritesheet1","county_grey"),this.sprite=game.add.sprite(0,0,"spritesheet1","county_grey")}this.bg.scale.setTo(SCALE*tileScaleMod,SCALE*tileScaleMod),this.bg.x=tileStartX+i*this.bg.width-102,this.bg.y=TILE_START_Y+j*this.bg.height,this.bg.alpha=0,levelGroup.add(this.bg),this.sprite.anchor.setTo(.5,.5),this.sprite.scale.setTo(SCALE*tileScaleMod*2,SCALE*tileScaleMod*2),this.sprite.x=tileStartX+i*this.sprite.width+this.sprite.width/2-102,this.sprite.y=TILE_START_Y+j*this.sprite.height+this.sprite.height/2,this.sprite.inputEnabled=!0,this.sprite.tile=this,this.sprite.events.onInputDown.add(onInputDownTile,this),this.sprite.events.onInputOver.add(onInputOverTile,this),this.sprite.events.onInputOut.add(onInputOutTile,this),levelGroup.add(this.sprite),gameMode==GameMode.WALKTHROUGH&&(this.bg.x-=WALKTHROUGH_X_ADJ,this.sprite.x-=WALKTHROUGH_X_ADJ),this.color!=TileColor.NONE&&(this.previewBG.scale.setTo(SCALE*tileScaleMod*200,SCALE*tileScaleMod*200),this.previewBG.x=this.bg.x,this.previewBG.y=this.bg.y,this.previewBG.alpha=0),this.grown=!1,this.originalWidth=this.sprite.width,this.originalHeight=this.sprite.height,this.index=tileIndexes,this.checked=!1,this.selected=!1,this.top=null,this.bottom=null,this.left=null,this.right=null,this.tConnect=null,this.bConnect=null,this.lConnect=null,this.rConnect=null,tileIndexes++}assignLines(top,bottom,left,right){this.top=top,this.bottom=bottom,this.right=right,this.left=left,this.ul=null,this.ur=null,this.j>0&&(this.i>0&&(this.ul=new Corner(this.top.sprites[0].x,this.top.sprites[0].y),corners.push(this.ul)),this.i<gridWidth-1&&(this.ur=new Corner(this.top.sprites[0].x+this.top.sprites[0].width,this.top.sprites[0].y),corners.push(this.ur)))}changeAlpha(){this.sprite.alpha=0}setColor(color,faded){switch(color){case TileColor.RED:faded?this.bg.loadTexture("spritesheet1","redtile_Faded"):this.bg.loadTexture("spritesheet1","redtile");break;case TileColor.BLUE:faded?this.bg.loadTexture("spritesheet1","bluetile_Faded"):this.bg.loadTexture("spritesheet1","bluetile");break;case TileColor.NONE:faded?this.bg.loadTexture("spritesheet1","graytile_Faded"):this.bg.loadTexture("spritesheet1","graytile")}this.bg.alpha=1,this.top.setColor(color,LineSide.TOP),this.bottom.setColor(color,LineSide.BOTTOM),this.left.setColor(color,LineSide.LEFT),this.right.setColor(color,LineSide.RIGHT)}pulsePreview(deltaTime){this.previewBG.alpha+=deltaTime*previewAlphaDir*2,this.previewBG.alpha>1?this.previewBG.alpha=1:this.previewBG.alpha<0&&(this.previewBG.alpha=0)}removePreview(){this.previewBG.alpha=0}selectConnectors(){this.tConnect&&this.tConnect.active&&(this.tConnect.alpha=1),this.bConnect&&this.bConnect.active&&(this.bConnect.alpha=1),this.lConnect&&this.lConnect.active&&(this.lConnect.alpha=1),this.rConnect&&this.rConnect.active&&(this.rConnect.alpha=1)}setConnectors(){null!=this.tConnect&&(this.top.on||!this.tConnect.active?this.tConnect.alpha=0:this.tConnect.alpha=1),null!=this.bConnect&&(this.bottom.on||!this.bConnect.active?this.bConnect.alpha=0:this.bConnect.alpha=1),null!=this.lConnect&&(this.left.on||!this.lConnect.active?this.lConnect.alpha=0:this.lConnect.alpha=1),null!=this.rConnect&&(this.right.on||!this.rConnect.active?this.rConnect.alpha=0:this.rConnect.alpha=1)}grow(){this.grown||(this.sprite.width=1.1*this.sprite.width,this.sprite.height=1.1*this.sprite.height,this.grown=!0)}shrink(){this.grown&&(this.sprite.width=this.originalWidth,this.sprite.height=this.originalHeight,this.grown=!1)}cleanup(){this.sprite.events.onInputDown.remove(onInputDownTile,this),this.sprite.events.onInputOver.remove(onInputOverTile,this),this.sprite.events.onInputOut.remove(onInputOutTile,this)}}class TileGroup{constructor(){this.tiles=[],this.lines=[],this.color=TileColor.NONE}addTile(index){this.tiles.push(index)}removeTile(index){var removeIndex=this.tiles.indexOf(index);this.tiles.splice(removeIndex,1)}addLine(line){-1==this.lines.indexOf(line)&&this.lines.push(line)}removeLine(line){var removeIndex=this.lines.indexOf(line);this.lines.splice(removeIndex,1)}checkForTile(index){return this.tiles.indexOf(index)>-1}calculateColor(){for(var playerCount=0,opponentCount=0,tile=null,i=0;i<this.tiles.length;i++)null!=(tile=this.tiles[i])&&(tile.color==playerColor?playerCount++:opponentCount++);this.color=playerCount>opponentCount?playerColor:opponentCount>playerCount?opponentColor:TileColor.NONE}}var CURSOR_MOVE_SPEED=10,TEXT_MOVE_SPEED=75,WALKTHROUGH_TIME=5,SKIP_TEXT="SKIP THIS...";WalkthroughState={PLAY:0,CURSOR:1,VOTE_BAR:2};class Walkthrough{constructor(){this.group=game.add.group(),this.box=game.add.sprite(0,0,"spritesheet1","Speech_Small"),this.box.scale.setTo(5.55*SCALE,2.5*SCALE),this.box.x=170,this.box.y=gameHeight,this.group.add(this.box),(gerry=game.add.sprite(0,0,"spritesheet1","gerry_idle")).anchor.setTo(.5,.5),gerry.x=.125*gameWidth,gerry.y=gameHeight+gerry.height/2;var style={font:"24px "+MONT_FONT,fill:"#000000",align:"start",wordWrap:!0,wordWrapWidth:this.box.width-40};this.text=game.add.text(this.box.width-25,this.box.height-25,"",style),this.text.x=gameWidth+this.text.width,this.text.y=435,this.textIndex=0,this.text.alpha=1,this.group.add(this.text),this.click=game.add.sprite(0,0,"spritesheet1","click"),this.click.anchor.setTo(.5,.5),this.click.scale.setTo(2*SCALE,2*SCALE),this.click.alpha=0,this.group.add(this.click),this.hand=game.add.sprite(.6*gameWidth,.9*gameHeight,"blueCursor"),this.hand.anchor.setTo(.5,.5),this.hand.scale.setTo(2*SCALE,2*SCALE),this.hand.alpha=0,this.group.add(this.hand),this.skipButton=game.add.button(0,0,"",this.endAnimations.bind(this)),this.skipButton.input.useHandCursor=!1,this.skipButton.anchor.setTo(.5,.5),this.skipButton.width=160,this.skipButton.height=50,this.skipButton.x=.935*gameWidth,this.skipButton.y=gameHeight-this.skipButton.height/3,this.skipButton.alpha=0,this.group.add(this.skipButton),style={font:"18px "+PHOS_FONT,fill:"#999999",align:"center"},this.skipText=game.add.text(0,0,SKIP_TEXT,style),this.skipText.anchor.setTo(.5,.5),this.skipText.x=this.skipButton.x,this.skipText.y=this.skipButton.y,this.skipText.alpha=0,this.group.add(this.skipText)}update(deltaTime){!this.mouseDown&&game.input.activePointer.isDown?(this.mouseDown=!0,this.timer=0,this.advance()):this.mouseDown&&!game.input.activePointer.isDown?(this.mouseDown=!1,this.timer=0):(this.timer+=deltaTime,this.timer>WALKTHROUGH_TIME&&(this.timer=0,this.advance()));for(var i=0;i<this.animations.length;i++)this.animations[i].update()}activate(){this.mouseDown=!1,this.skipButton.inputEnabled=!0,this.finish=!1,this.textIndex=0,this.timer=0,this.state=WalkthroughState.PLAY,game.world.bringToTop(this.group),this.createAnimations()}deactivate(){gameMode=GameMode.PLAY,this.finish=!0,this.skipButton.inputEnabled=!1,this.skipButton.alpha=0,this.skipText.alpha=0,this.click.alpha=0,this.hand.alpha=0,this.box.alpha=0,0==currentLevelIndex?next():(removeLevelElements(),reactivateButtons(),generateLevel())}reset(){this.box.x=170,this.box.y=gameHeight,this.box.alpha=1,gerry.x=.125*gameWidth,gerry.y=gameHeight+gerry.height/2,this.text.y=435,this.click.alpha=0,this.hand.alpha=0,this.skipButton.width=160,this.skipButton.height=50,this.skipButton.alpha=0,this.skipText.alpha=0}removeForGame(){this.box.alpha>0&&(this.box.alpha=0),this.text.alpha>0&&(this.text.alpha=0),null!=this.skipButton&&(this.skipButton.inputEnabled=!1,this.skipButton.alpha=0)}advance(){switch(this.state){case WalkthroughState.PLAY:2==this.textIndex?(this.createCursorAnimation(),this.state=WalkthroughState.CURSOR,this.textIndex++):3==this.textIndex?(this.moveVoteBar(),this.state=WalkthroughState.VOTE_BAR,this.textIndex++):5==this.textIndex?this.finishAnimations():6==this.textIndex?this.deactivate():(this.textIndex++,this.setNextText())}}createAnimations(){this.animations=[];var animation=new Animation(gerry,AnimationType.MOVE,new Phaser.Point(gerry.x,gerry.y),new Phaser.Point(gerry.x,.85*gameHeight),0,0,null,null,ANIM_IN_SPEED,0,0,0,!1,!1);this.animations.push(animation),animation=new Animation(this.box,AnimationType.MOVE,new Phaser.Point(this.box.x,this.box.y),new Phaser.Point(this.box.x,400),0,0,null,null,4*ANIM_IN_SPEED,0,0,0,!1,!1),this.animations.push(animation),this.animations[this.animations.length-2].setNextAnimation(animation),animation=new Animation(this.skipText,AnimationType.FADE_IN,null,null,0,0,null,null,0,0,2*FADE_IN_SPEED,0,!1,!1),this.animations.push(animation),this.animations[this.animations.length-2].setNextAnimation(animation);var callback=this.setNextText.bind(this);animation.setCallback(callback),this.animations[0].state=AnimationState.ON}createCursorAnimation(){this.animations=[];var animation=new Animation(this.hand,AnimationType.FADE_IN,null,null,0,0,null,null,0,0,2*FADE_IN_SPEED,0,!1,!1);this.animations.push(animation),animation=new Animation(this.hand,AnimationType.MOVE,new Phaser.Point(this.hand.x,this.hand.y),new Phaser.Point(tiles[1][1].sprite.x,tiles[1][1].sprite.y),0,0,null,null,CURSOR_MOVE_SPEED,0,0,0,!1,!1),this.animations.push(animation),this.animations[this.animations.length-2].setNextAnimation(animation);var callback=this.addClick.bind(this);animation.setCallback(callback),this.animations[0].state=AnimationState.ON}addClick(){this.click.x=this.hand.x,this.click.y=this.hand.y,this.animations=[];var animation=new Animation(this.click,AnimationType.FADE_IN,null,null,0,0,null,null,0,0,FADE_IN_SPEED,0,!1,!1);this.animations.push(animation);var callback=this.startSelection.bind(this);animation.setCallback(callback),animation.state=AnimationState.ON}startSelection(){currentTile=tiles[1][1],startCreateDistrict(),calculateDistricts(),setCorners(),setConnectors(),this.animations=[];var animation=new Animation(this.click,AnimationType.MOVE,new Phaser.Point(this.click.x,this.click.y),new Phaser.Point(tiles[1][2].sprite.x,tiles[1][2].sprite.y),0,0,null,null,CURSOR_MOVE_SPEED,0,0,0,!1,!1);this.animations.push(animation),animation=new Animation(this.hand,AnimationType.MOVE,new Phaser.Point(this.hand.x,this.hand.y),new Phaser.Point(tiles[1][2].sprite.x,tiles[1][2].sprite.y),0,0,null,null,CURSOR_MOVE_SPEED,0,0,0,!1,!1),this.animations.push(animation),this.animations[this.animations.length-2].setNextAnimation(animation),this.nextTile=tiles[1][2];var callback=this.selectNextTile.bind(this);animation.setCallback(callback),this.animations[0].state=AnimationState.ON,this.animations[1].state=AnimationState.ON}continueSelection(){if(1==groups.length)if(2==currentSelectGroup.length){this.animations=[];animation=new Animation(this.click,AnimationType.MOVE,new Phaser.Point(this.click.x,this.click.y),new Phaser.Point(tiles[2][2].sprite.x,tiles[2][2].sprite.y),0,0,null,null,CURSOR_MOVE_SPEED,0,0,0,!1,!1);this.animations.push(animation),animation=new Animation(this.hand,AnimationType.MOVE,new Phaser.Point(this.hand.x,this.hand.y),new Phaser.Point(tiles[2][2].sprite.x,tiles[2][2].sprite.y),0,0,null,null,CURSOR_MOVE_SPEED,0,0,0,!1,!1),this.animations.push(animation),this.nextTile=tiles[2][2];callback=this.selectNextTile.bind(this);animation.setCallback(callback),this.animations[0].state=AnimationState.ON,this.animations[1].state=AnimationState.ON}else 3==currentSelectGroup.length&&this.moveCursorToNextSelection();else if(2==groups.length)if(2==currentSelectGroup.length){this.animations=[];animation=new Animation(this.click,AnimationType.MOVE,new Phaser.Point(this.click.x,this.click.y),new Phaser.Point(tiles[3][2].sprite.x,tiles[3][2].sprite.y),0,0,null,null,CURSOR_MOVE_SPEED,0,0,0,!1,!1);this.animations.push(animation),animation=new Animation(this.hand,AnimationType.MOVE,new Phaser.Point(this.hand.x,this.hand.y),new Phaser.Point(tiles[3][2].sprite.x,tiles[3][2].sprite.y),0,0,null,null,CURSOR_MOVE_SPEED,0,0,0,!1,!1),this.animations.push(animation),this.nextTile=tiles[3][2];callback=this.selectNextTile.bind(this);animation.setCallback(callback),this.animations[0].state=AnimationState.ON,this.animations[1].state=AnimationState.ON}else 3==currentSelectGroup.length&&this.moveCursorToNextSelection();else if(2==currentSelectGroup.length){this.animations=[];animation=new Animation(this.click,AnimationType.MOVE,new Phaser.Point(this.click.x,this.click.y),new Phaser.Point(tiles[3][3].sprite.x,tiles[3][3].sprite.y),0,0,null,null,CURSOR_MOVE_SPEED,0,0,0,!1,!1);this.animations.push(animation),animation=new Animation(this.hand,AnimationType.MOVE,new Phaser.Point(this.hand.x,this.hand.y),new Phaser.Point(tiles[3][3].sprite.x,tiles[3][3].sprite.y),0,0,null,null,CURSOR_MOVE_SPEED,0,0,0,!1,!1),this.animations.push(animation),this.nextTile=tiles[3][3];callback=this.selectNextTile.bind(this);animation.setCallback(callback),this.animations[0].state=AnimationState.ON,this.animations[1].state=AnimationState.ON}else if(3==currentSelectGroup.length){this.animations=[];var animation=new Animation(this.click,AnimationType.FADE_OUT,null,null,0,0,null,null,0,0,FADE_OUT_SPEED,0,!1,!1);this.animations.push(animation),(animation=new Animation(null,AnimationType.DELAY,null,null,0,0,null,null,0,0,0,0,!1,!1)).setDelayParams(300,5),this.animations.push(animation);var callback=this.moveBoard.bind(this);animation.setCallback(callback),this.animations[0].state=AnimationState.ON,this.animations[1].state=AnimationState.ON}}selectNextTile(){selectTile(this.nextTile),calculateDistricts(),setCorners(),setConnectors(),this.continueSelection()}moveCursorToNextSelection(){var tile;tile=1==groups.length?tiles[2][1]:tiles[1][3],this.animations=[];var animation=new Animation(this.click,AnimationType.FADE_OUT,null,null,0,0,null,null,0,0,FADE_OUT_SPEED,0,!1,!1);this.animations.push(animation),(animation=new Animation(null,AnimationType.DELAY,null,null,0,0,null,null,0,0,0,0,!1,!1)).setDelayParams(300,5),this.animations.push(animation),this.animations[this.animations.length-2].setNextAnimation(animation),animation=new Animation(this.hand,AnimationType.MOVE,new Phaser.Point(this.hand.x,this.hand.y),new Phaser.Point(tile.sprite.x,tile.sprite.y),0,0,null,null,CURSOR_MOVE_SPEED,0,0,0,!1,!1),this.animations.push(animation),this.animations[this.animations.length-2].setNextAnimation(animation);var callback=this.nextClick.bind(this);animation.setCallback(callback),this.animations[0].state=AnimationState.ON}nextClick(){this.click.x=this.hand.x,this.click.y=this.hand.y,this.animations=[];var animation=new Animation(this.click,AnimationType.FADE_IN,null,null,0,0,null,null,0,0,FADE_IN_SPEED,0,!1,!1);this.animations.push(animation);var callback;callback=1==groups.length?this.startSecondSelection.bind(this):this.startThirdSelection.bind(this),animation.setCallback(callback),animation.state=AnimationState.ON}startSecondSelection(){currentTile=tiles[2][1],startCreateDistrict(),calculateDistricts(),setCorners(),setConnectors(),this.animations=[];var animation=new Animation(this.click,AnimationType.MOVE,new Phaser.Point(this.click.x,this.click.y),new Phaser.Point(tiles[3][1].sprite.x,tiles[3][1].sprite.y),0,0,null,null,CURSOR_MOVE_SPEED,0,0,0,!1,!1);this.animations.push(animation),animation=new Animation(this.hand,AnimationType.MOVE,new Phaser.Point(this.hand.x,this.hand.y),new Phaser.Point(tiles[3][1].sprite.x,tiles[3][1].sprite.y),0,0,null,null,CURSOR_MOVE_SPEED,0,0,0,!1,!1),this.animations.push(animation),this.nextTile=tiles[3][1];var callback=this.selectNextTile.bind(this);animation.setCallback(callback),this.animations[0].state=AnimationState.ON,this.animations[1].state=AnimationState.ON}startThirdSelection(){currentTile=tiles[1][3],startCreateDistrict(),calculateDistricts(),setCorners(),setConnectors(),this.animations=[];var animation=new Animation(this.click,AnimationType.MOVE,new Phaser.Point(this.click.x,this.click.y),new Phaser.Point(tiles[2][3].sprite.x,tiles[2][3].sprite.y),0,0,null,null,CURSOR_MOVE_SPEED,0,0,0,!1,!1);this.animations.push(animation),animation=new Animation(this.hand,AnimationType.MOVE,new Phaser.Point(this.hand.x,this.hand.y),new Phaser.Point(tiles[2][3].sprite.x,tiles[2][3].sprite.y),0,0,null,null,CURSOR_MOVE_SPEED,0,0,0,!1,!1),this.animations.push(animation),this.nextTile=tiles[2][3];var callback=this.selectNextTile.bind(this);animation.setCallback(callback),this.animations[0].state=AnimationState.ON,this.animations[1].state=AnimationState.ON}moveBoard(){var animation;this.animations=[];for(i=0;i<gridWidth;i++)for(j=0;j<gridHeight;j++)animation=new Animation(tiles[i][j].sprite,AnimationType.MOVE,new Phaser.Point(tiles[i][j].sprite.x,tiles[i][j].sprite.y),new Phaser.Point(tiles[i][j].sprite.x+WALKTHROUGH_X_ADJ,tiles[i][j].sprite.y),0,0,null,null,ANIM_IN_SPEED,0,0,0,!1,!1),this.animations.push(animation),animation.state=AnimationState.ON,animation=new Animation(tiles[i][j].bg,AnimationType.MOVE,new Phaser.Point(tiles[i][j].bg.x,tiles[i][j].bg.y),new Phaser.Point(tiles[i][j].bg.x+WALKTHROUGH_X_ADJ,tiles[i][j].bg.y),0,0,null,null,ANIM_IN_SPEED,0,0,0,!1,!1),this.animations.push(animation),animation.state=AnimationState.ON;for(i=0;i<hLines.length;i++)for(j=0;j<hLines[i].length;j++)for(k=0;k<hLines[i][j].sprites.length;k++)animation=new Animation(hLines[i][j].sprites[k],AnimationType.MOVE,new Phaser.Point(hLines[i][j].sprites[k].x,hLines[i][j].sprites[k].y),new Phaser.Point(hLines[i][j].sprites[k].x+WALKTHROUGH_X_ADJ,hLines[i][j].sprites[k].y),0,0,null,null,ANIM_IN_SPEED,0,0,0,!1,!1),this.animations.push(animation),animation.state=AnimationState.ON;for(i=0;i<vLines.length;i++)for(var j=0;j<vLines[i].length;j++)for(var k=0;k<vLines[i][j].sprites.length;k++)animation=new Animation(vLines[i][j].sprites[k],AnimationType.MOVE,new Phaser.Point(vLines[i][j].sprites[k].x,vLines[i][j].sprites[k].y),new Phaser.Point(vLines[i][j].sprites[k].x+WALKTHROUGH_X_ADJ,vLines[i][j].sprites[k].y),0,0,null,null,ANIM_IN_SPEED,0,0,0,!1,!1),this.animations.push(animation),animation.state=AnimationState.ON;for(i=0;i<hConnectors.length;i++)animation=new Animation(hConnectors[i],AnimationType.MOVE,new Phaser.Point(hConnectors[i].x,hConnectors[i].y),new Phaser.Point(hConnectors[i].x+WALKTHROUGH_X_ADJ,hConnectors[i].y),0,0,null,null,ANIM_IN_SPEED,0,0,0,!1,!1),this.animations.push(animation),animation.state=AnimationState.ON;for(i=0;i<vConnectors.length;i++)animation=new Animation(vConnectors[i],AnimationType.MOVE,new Phaser.Point(vConnectors[i].x,vConnectors[i].y),new Phaser.Point(vConnectors[i].x+WALKTHROUGH_X_ADJ,vConnectors[i].y),0,0,null,null,ANIM_IN_SPEED,0,0,0,!1,!1),this.animations.push(animation),animation.state=AnimationState.ON;for(var i=0;i<corners.length;i++)animation=new Animation(corners[i].ul,AnimationType.MOVE,new Phaser.Point(corners[i].ul.x,corners[i].ul.y),new Phaser.Point(corners[i].ul.x+WALKTHROUGH_X_ADJ,corners[i].ul.y),0,0,null,null,ANIM_IN_SPEED,0,0,0,!1,!1),this.animations.push(animation),animation.state=AnimationState.ON,animation=new Animation(corners[i].ur,AnimationType.MOVE,new Phaser.Point(corners[i].ur.x,corners[i].ur.y),new Phaser.Point(corners[i].ur.x+WALKTHROUGH_X_ADJ,corners[i].ur.y),0,0,null,null,ANIM_IN_SPEED,0,0,0,!1,!1),this.animations.push(animation),animation.state=AnimationState.ON,animation=new Animation(corners[i].bl,AnimationType.MOVE,new Phaser.Point(corners[i].bl.x,corners[i].bl.y),new Phaser.Point(corners[i].bl.x+WALKTHROUGH_X_ADJ,corners[i].bl.y),0,0,null,null,ANIM_IN_SPEED,0,0,0,!1,!1),this.animations.push(animation),animation.state=AnimationState.ON,animation=new Animation(corners[i].br,AnimationType.MOVE,new Phaser.Point(corners[i].br.x,corners[i].br.y),new Phaser.Point(corners[i].br.x+WALKTHROUGH_X_ADJ,corners[i].br.y),0,0,null,null,ANIM_IN_SPEED,0,0,0,!1,!1),this.animations.push(animation),animation.state=AnimationState.ON;animation=new Animation(boardBG,AnimationType.MOVE,new Phaser.Point(boardBG.x,boardBG.y),new Phaser.Point(.43*gameWidth,boardBG.y),0,0,null,null,ANIM_IN_SPEED,0,0,0,!1,!1),this.animations.push(animation),animation.state=AnimationState.ON,animation=new Animation(this.hand,AnimationType.FADE_OUT,null,null,0,0,null,null,0,0,2*FADE_IN_SPEED,0,!1,!1),this.animations.push(animation),animation.state=AnimationState.ON;var callback=this.moveStatusBars.bind(this);animation.setCallback(callback)}moveStatusBars(){this.animations=[];var animation=new Animation(populationStatus.bar.playerBar,AnimationType.MOVE,new Phaser.Point(populationStatus.bar.playerBar.x,populationStatus.bar.playerBar.y),new Phaser.Point(STATUS_BAR_X,populationStatus.bar.playerBar.y),0,0,null,null,2*ANIM_IN_SPEED,0,0,0,!1,!1);this.animations.push(animation),animation=new Animation(populationStatus.bar.opponentBar,AnimationType.MOVE,new Phaser.Point(populationStatus.bar.opponentBar.x,populationStatus.bar.opponentBar.y),new Phaser.Point(STATUS_BAR_X+populationStatus.bar.playerBar.width,populationStatus.bar.opponentBar.y),0,0,null,null,2*ANIM_IN_SPEED,0,0,0,!1,!1),this.animations.push(animation),this.animations[this.animations.length-2].setNextAnimation(animation),animation=new Animation(populationStatus.text,AnimationType.MOVE,new Phaser.Point(populationStatus.text.x,populationStatus.text.y),new Phaser.Point(STATUS_BAR_X+populationStatus.text.width/2,populationStatus.text.y),0,0,null,null,2*ANIM_IN_SPEED,0,0,0,!1,!1),this.animations.push(animation),this.animations[this.animations.length-2].setNextAnimation(animation);var callback=this.setNextText.bind(this);animation.setCallback(callback),this.animations[0].state=AnimationState.ON}setNextText(){this.text.x=gameWidth,this.text.alpha=1,this.text.text=walkthroughsJSON.walkthroughs[this.textIndex].walkthrough,this.setTextColors(),this.state=WalkthroughState.PLAY,this.animations=[];var animation=new Animation(this.text,AnimationType.MOVE,new Phaser.Point(this.text.x,this.text.y),new Phaser.Point(this.box.x+25,this.text.y),0,0,null,null,TEXT_MOVE_SPEED,0,0,0,!1,!1);this.animations.push(animation),this.animations[0].state=AnimationState.ON,audio.playSound(SoundType.WHOOSH)}setTextColors(){if(this.text.colors=[],null!=walkthroughsJSON.walkthroughs[this.textIndex].colors)for(var i=0;i<walkthroughsJSON.walkthroughs[this.textIndex].colors.length;i++)this.text.addColor(walkthroughsJSON.walkthroughs[this.textIndex].colors[i].color,walkthroughsJSON.walkthroughs[this.textIndex].colors[i].index);else this.text.addColor(0,0)}moveVoteBar(){this.animations=[];var animation=new Animation(voteStatus.bar.playerBar,AnimationType.MOVE,new Phaser.Point(voteStatus.bar.playerBar.x,voteStatus.bar.playerBar.y),new Phaser.Point(STATUS_BAR_X,voteStatus.bar.playerBar.y),0,0,null,null,2*ANIM_IN_SPEED,0,0,0,!1,!1);this.animations.push(animation),animation=new Animation(voteStatus.bar.opponentBar,AnimationType.MOVE,new Phaser.Point(voteStatus.bar.opponentBar.x,voteStatus.bar.opponentBar.y),new Phaser.Point(STATUS_BAR_X+voteStatus.bar.playerBar.width,voteStatus.bar.opponentBar.y),0,0,null,null,2*ANIM_IN_SPEED,0,0,0,!1,!1),this.animations.push(animation),this.animations[this.animations.length-2].setNextAnimation(animation),animation=new Animation(voteStatus.bar.noneBar,AnimationType.MOVE,new Phaser.Point(voteStatus.bar.noneBar.x,voteStatus.bar.noneBar.y),new Phaser.Point(STATUS_BAR_X+voteStatus.bar.playerBar.width+voteStatus.bar.opponentBar.width,voteStatus.bar.opponentBar.y),0,0,null,null,2*ANIM_IN_SPEED,0,0,0,!1,!1),this.animations.push(animation),this.animations[this.animations.length-2].setNextAnimation(animation),animation=new Animation(voteStatus.text,AnimationType.MOVE,new Phaser.Point(voteStatus.text.x,voteStatus.text.y),new Phaser.Point(voteStatus.text.width/2+STATUS_BAR_X,voteStatus.text.y),0,0,null,null,2*ANIM_IN_SPEED,0,0,0,!1,!1),this.animations.push(animation),this.animations[this.animations.length-2].setNextAnimation(animation);var callback=this.setNextText.bind(this);animation.setCallback(callback),this.animations[0].state=AnimationState.ON}finishAnimations(){this.animations=[];var animation=new Animation(levelText,AnimationType.MOVE,new Phaser.Point(levelText.x,levelText.y),new Phaser.Point(levelText.x,.02*gameHeight),0,0,null,null,2*ANIM_IN_SPEED,0,0,0,!1,!1);this.animations.push(animation),animation=new Animation(teamText,AnimationType.MOVE,new Phaser.Point(teamText.x,teamText.y),new Phaser.Point(.115*gameWidth,teamText.y),0,0,null,null,2*ANIM_IN_SPEED,0,0,0,!1,!1);var callback=this.finishText.bind(this);animation.setCallback(callback),this.animations.push(animation),this.animations[this.animations.length-2].setNextAnimation(animation),this.animations[0].state=AnimationState.ON}finishText(){this.textIndex++,this.setNextText()}endAnimations(){this.animations=[],this.deactivate()}}